import{_ as n}from"./plugin-vue_export-helper.21dcd24c.js";import{o as s,c as a,e}from"./app.38570110.js";const t={},p=e(`<h1 id="rabbitmq" tabindex="-1"><a class="header-anchor" href="#rabbitmq" aria-hidden="true">#</a> rabbitmq</h1><blockquote><p>rabbitmq\u7684\u90E8\u7F72\uFF0C\u96C6\u7FA4\u914D\u7F6E\uFF0C\u5E38\u7528\u547D\u4EE4\u7B49</p></blockquote><h2 id="docker\u90E8\u7F72rabbitmq" tabindex="-1"><a class="header-anchor" href="#docker\u90E8\u7F72rabbitmq" aria-hidden="true">#</a> docker\u90E8\u7F72rabbitmq</h2><blockquote><p>\u90E8\u7F72\u5728\u5185\u7F51\u4E24\u4E2A\u8282\u70B9\uFF0C\u4F7F\u7528\u955C\u50CF\u96C6\u7FA4\u914D\u7F6E</p></blockquote><h3 id="\u4E24\u53F0\u673A\u751F\u6210\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u4E24\u53F0\u673A\u751F\u6210\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> \u4E24\u53F0\u673A\u751F\u6210\u914D\u7F6E\u6587\u4EF6</h3><p>node1 docker-compose.yml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3.8&#39;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> rabbitmq<span class="token punctuation">:</span>3.12.8<span class="token punctuation">-</span>management
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> rabbitmq
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> node1 <span class="token comment"># \u8282\u70B9\u540D\u79F0</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped <span class="token comment"># \u9664\u975Estop\u547D\u4EE4\u5426\u5219\u81EA\u52A8\u91CD\u542F</span>
    <span class="token key atrule">mem_limit</span><span class="token punctuation">:</span> 8g        <span class="token comment"># \u9650\u5236\u6700\u591A\u4F7F\u7528 8GB \u5185\u5B58</span>
    <span class="token key atrule">cpus</span><span class="token punctuation">:</span> <span class="token number">6</span>              <span class="token comment"># \u9650\u5236\u6700\u591A\u4F7F\u7528 6 \u4E2A CPU</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;192.168.2.135:5672:5672&quot;</span>  <span class="token comment"># AMQP\u534F\u8BAE\u7AEF\u53E3</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;15672:15672&quot;</span>  <span class="token comment"># \u7BA1\u7406\u754C\u9762\u7AEF\u53E3</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;192.168.2.135:4369:4369&quot;</span> <span class="token comment"># \u96C6\u7FA4\u901A\u4FE1\u7AEF\u53E3</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;192.168.2.135:25672:25672&quot;</span> <span class="token comment"># \u96C6\u7FA4\u901A\u4FE1\u7AEF\u53E3</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">RABBITMQ_DEFAULT_USER</span><span class="token punctuation">:</span> <span class="token string">&quot;jobui&quot;</span>
      <span class="token key atrule">RABBITMQ_DEFAULT_PASS</span><span class="token punctuation">:</span> <span class="token string">&quot;jobui123&quot;</span>
      <span class="token key atrule">RABBITMQ_ERLANG_COOKIE</span><span class="token punctuation">:</span> <span class="token string">&quot;jobui_rabbit&quot;</span>  <span class="token comment"># \u96C6\u7FA4\u901A\u4FE1\u5BC6\u94A5</span>
      <span class="token key atrule">RABBITMQ_NODENAME</span><span class="token punctuation">:</span> rabbit@node1
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /ssd_data/rabbitmq/data<span class="token punctuation">:</span>/var/lib/rabbitmq  <span class="token comment"># \u6570\u636E\u6301\u4E45\u5316</span>
    <span class="token key atrule">extra_hosts</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;node2:192.168.2.139&quot;</span> <span class="token comment"># \u5173\u952E\uFF1A\u8BA9\u5BB9\u5668\u80FD\u89E3\u6790node2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>node2 docker-compose.yml</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3.8&#39;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> rabbitmq<span class="token punctuation">:</span>3.12.8<span class="token punctuation">-</span>management <span class="token comment"># \u6216\u6307\u5B9A\u7248\u672C\u5982 rabbitmq:3.12</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> rabbitmq
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> node2
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped
    <span class="token key atrule">mem_limit</span><span class="token punctuation">:</span> 8g        <span class="token comment"># \u9650\u5236\u6700\u591A\u4F7F\u7528 8GB \u5185\u5B58</span>
    <span class="token key atrule">cpus</span><span class="token punctuation">:</span> <span class="token number">6</span>              <span class="token comment"># \u9650\u5236\u6700\u591A\u4F7F\u7528 6 \u4E2A CPU</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;192.168.2.139:5672:5672&quot;</span>  <span class="token comment"># AMQP\u534F\u8BAE\u7AEF\u53E3</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;192.168.2.139:4369:4369&quot;</span>  <span class="token comment"># \u96C6\u7FA4\u901A\u4FE1\u7AEF\u53E3</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;192.168.2.139:25672:25672&quot;</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">RABBITMQ_DEFAULT_USER</span><span class="token punctuation">:</span> <span class="token string">&quot;jobui&quot;</span>
      <span class="token key atrule">RABBITMQ_DEFAULT_PASS</span><span class="token punctuation">:</span> <span class="token string">&quot;jobui123&quot;</span>
      <span class="token key atrule">RABBITMQ_ERLANG_COOKIE</span><span class="token punctuation">:</span> <span class="token string">&quot;jobui_rabbit&quot;</span>  <span class="token comment"># \u96C6\u7FA4\u901A\u4FE1\u5BC6\u94A5</span>
      <span class="token key atrule">RABBITMQ_NODENAME</span><span class="token punctuation">:</span> rabbit@node2
      <span class="token key atrule">RABBITMQ_CLUSTER_NODES</span><span class="token punctuation">:</span> rabbit@node1  <span class="token comment"># \u6307\u5411\u521D\u59CB\u8282\u70B9</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /ssdb_data/rabbitmq/data<span class="token punctuation">:</span>/var/lib/rabbitmq
    <span class="token key atrule">extra_hosts</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;node1:192.168.2.135&quot;</span>  <span class="token comment"># \u5173\u952E\uFF1A\u8BA9\u5BB9\u5668\u80FD\u89E3\u6790node1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u5206\u522B\u542F\u52A8\u5BB9\u5668" tabindex="-1"><a class="header-anchor" href="#\u5206\u522B\u542F\u52A8\u5BB9\u5668" aria-hidden="true">#</a> \u5206\u522B\u542F\u52A8\u5BB9\u5668</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u8282\u70B9dns\u914D\u7F6E\u5199\u5165hosts" tabindex="-1"><a class="header-anchor" href="#\u8282\u70B9dns\u914D\u7F6E\u5199\u5165hosts" aria-hidden="true">#</a> \u8282\u70B9dns\u914D\u7F6E\u5199\u5165hosts</h3><p>node1\u5199\u5165</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;192.168.2.139 node2&quot;</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/hosts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>node2\u5199\u5165</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;192.168.2.135 node1&quot;</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/hosts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="node2\u52A0\u5165\u96C6\u7FA4" tabindex="-1"><a class="header-anchor" href="#node2\u52A0\u5165\u96C6\u7FA4" aria-hidden="true">#</a> node2\u52A0\u5165\u96C6\u7FA4</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> rabbitmq rabbitmqctl stop_app	<span class="token comment"># \u505C\u6B62\u670D\u52A1</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> rabbitmq rabbitmqctl reset <span class="token comment"># \u91CD\u7F6E\u670D\u52A1\uFF08\u4F1A\u6E05\u9664\u6570\u636E\uFF09</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> rabbitmq rabbitmqctl join_cluster rabbit@node1 <span class="token comment"># \u52A0\u5165\u8282\u70B9</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> rabbitmq rabbitmqctl start_app <span class="token comment"># \u542F\u52A8\u670D\u52A1</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> rabbitmq rabbitmqctl cluster_status <span class="token comment"># \u67E5\u770B\u96C6\u7FA4\u72B6\u6001</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u914D\u7F6E\u955C\u50CF\u96C6\u7FA4" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u955C\u50CF\u96C6\u7FA4" aria-hidden="true">#</a> \u914D\u7F6E\u955C\u50CF\u96C6\u7FA4</h3><p>\u5728\u4EFB\u610F\u8282\u70B9\u6267\u884C</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> rabbitmq rabbitmqctl set_policy ha-all <span class="token string">&quot;^&quot;</span> <span class="token string">&#39;{&quot;ha-mode&quot;:&quot;all&quot;}&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u914D\u7F6E\u9632\u706B\u5899" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u9632\u706B\u5899" aria-hidden="true">#</a> \u914D\u7F6E\u9632\u706B\u5899</h3><blockquote><p>docker\u542F\u52A8\u7684\u7AEF\u53E3\u9ED8\u8BA4\u6240\u6709ip\u90FD\u80FD\u8BF7\u6C42\uFF0C\u4E0D\u5B89\u5168\uFF0C\u4F46\u662Fdocker \u4F1A\u8986\u76D6 <code>firewalld</code> \u7684\u90E8\u5206\u89C4\u5219\uFF0C\u9700\u5728 <code>DOCKER-USER</code> \u94FE\u4E2D\u6DFB\u52A0\u89C4\u5219\uFF0C\u5148\u7981\u7528\u6240\u6709ip\u8BBF\u95EEweb\u7BA1\u7406\u7AEF\u53E3\u518D\u914D\u7F6E\u53EA\u5141\u8BB8\u6307\u5B9Aip\u8BBF\u95EE\uFF0C</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> iptables <span class="token parameter variable">-I</span> DOCKER-<span class="token environment constant">USER</span> <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">15672</span> <span class="token parameter variable">-j</span> DROP
<span class="token function">sudo</span> iptables <span class="token parameter variable">-I</span> DOCKER-<span class="token environment constant">USER</span> <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">15672</span> <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.1.10 <span class="token parameter variable">-j</span> ACCEPT
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,24),l=[p];function i(c,o){return s(),a("div",null,l)}var d=n(t,[["render",i],["__file","rabbitmq.html.vue"]]);export{d as default};
