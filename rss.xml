<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <atom:link href="https://doflam-z.github.io/rss.xml" rel="self" type="application/rss+xml"/>
    <title>CodeNote</title>
    <link>https://doflam-z.github.io/</link>
    <description>ç¬”è®°ç½‘ç«™ã€‚</description>
    <language>zh-CN</language>
    <pubDate>Tue, 25 Mar 2025 02:00:47 GMT</pubDate>
    <lastBuildDate>Tue, 25 Mar 2025 02:00:47 GMT</lastBuildDate>
    <generator>vuepress-plugin-feed2</generator>
    <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
    <item>
      <title>Laravel</title>
      <link>https://doflam-z.github.io/php/laravel.html</link>
      <guid>https://doflam-z.github.io/php/laravel.html</guid>
      <source url="https://doflam-z.github.io/rss.xml">Laravel</source>
      <pubDate>Mon, 24 Mar 2025 02:00:00 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="laravel" tabindex="-1"> Laravel</h1>
<h3 id="ä½¿ç”¨composeræ–¹å¼éƒ¨ç½²laravelé¡¹ç›®" tabindex="-1"> ä½¿ç”¨composeræ–¹å¼éƒ¨ç½²laravelé¡¹ç›®</h3>
<p>åˆ‡æ¢å›½å†…é•œåƒ<a href="https://pkg.phpcomposer.com/" target="_blank" rel="noopener noreferrer">åœ°å€</a></p>
<div><pre><code><span>composer</span> config <span>-g</span> repo.packagist <span>composer</span> h <span>[</span>laravel.md<span>]</span><span>(</span>laravel.md<span>)</span> ttps://packagist.phpcomposer.com
</code></pre><div aria-hidden="true"><div></div></div></div><p>åˆ é™¤é•œåƒï¼ˆæ¢å¤å®˜æ–¹æºï¼‰</p>
<div><pre><code><span>composer</span> config <span>-g</span> <span>--unset</span> repos.packagist
</code></pre><div aria-hidden="true"><div></div></div></div><p>ä½¿ç”¨composeréƒ¨ç½²laravelé¡¹ç›®</p>
<div><pre><code><span># åœ¨å½“å‰ç›®å½•çš„/project_2020-3-16ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºlaravelçš„laravelé¡¹ç›®ï¼Œé»˜è®¤ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬laravelï¼Œä»¥å‹ç¼©åŒ…å½¢å¼ä»gitä¸Šä¸‹è½½</span>
<span>composer</span> create-project laravel/laravel --prefer-dist ./project_2020-3-16

<span># ä¹Ÿå¯æŒ‡å®šlaravelç‰ˆæœ¬</span>
<span>composer</span> create-project laravel/laravel<span>=</span><span>5.8</span>.* --prefer-dist ./project_2020-3-16
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>å‘½ä»¤è§£é‡Šï¼š</strong></p>
<p>composerï¼šè¡¨ç¤ºæ‰§è¡Œcomposerç¨‹åºï¼›</p>
<p>create-projectï¼šé€šè¿‡composerå»åˆ›å»ºé¡¹ç›®ï¼›</p>
<p>laravel/Laravelï¼šéœ€è¦åˆ›å»ºçš„é¡¹ç›®åç§°ï¼›</p>
<p>--prefer-distï¼šä¼˜å…ˆä¸‹è½½å‹ç¼©åŒ…æ–¹å¼ï¼Œè€Œä¸æ˜¯ç›´æ¥ä»githubä¸Šä¸‹è½½æºç ï¼ˆå…‹éš†ï¼‰ï¼›</p>
<p>./ï¼šè¡¨ç¤ºåˆ›å»ºçš„é¡¹ç›®ç›®å½•ä½ç½®ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç›®å½•åï¼›</p>
<p>æŒ‡å®šç‰ˆæœ¬åˆ›å»ºlaravelï¼š</p>
<p><code>composer create-project laravel/laravel=5.4.* --prefer-dist ./</code></p>
<p><strong>æŸ¥çœ‹ç³»ç»Ÿä¸­å·²æœ‰çš„è·¯ç”±åˆ—è¡¨</strong>=&gt;åœ¨é¡¹ç›®æ ¹ç›®å½•è¾“å…¥ ï¼š<code>php artisan route:list</code></p>
<p>è·¯ç”±ç¾¤ç»„å†™æ³•ï¼š</p>
<p><code>Route::goup(['frefix'=&gt;'admin'],function(){</code></p>
<p>â€‹		<code>Route::get('test',function(){ echo &quot;åŒ¹é…/admin/test&quot;;})</code></p>
<p><code>});</code></p>
<p><strong>åˆ›å»ºæ§åˆ¶å™¨</strong>TestController</p>
<p><code>php artisan make:controller TestController</code></p>
<p><strong>åˆ›å»ºæ¨¡å‹</strong>Test</p>
<p><code>php artisan make:model Home/Test</code></p>
<p><strong>No Application Encryption Key Has Been Specified</strong></p>
<ol>
<li>
<p>å¤åˆ¶.env.exampleåˆ°.envï¼š</p>
</li>
<li>
<p>cp -a .env.example .env</p>
</li>
<li>
<p>ç”Ÿæˆå¯†é’¥ï¼š</p>
</li>
<li>
<p>php artisan key:generate</p>
</li>
<li>
<p>ç„¶åæ‰è¿è¡Œï¼š</p>
</li>
<li>
<p>php artisan serve</p>
</li>
</ol>
<p><strong>Php artisan make:auth command is not defined</strong></p>
<p>Follow these three steps
Step 1 - First do this:</p>
<p>laravel new project</p>
<p><code>cd project</code></p>
<p><code>composer require laravel/ui --dev</code>
Note: Laravel UI Composer package is a new first-party package that extracts the UI portion of a Laravel project ( frontend scaffolding typically provided with previous releases of Laravel ) into a separate laravel/ui package. The separate package enables the Laravel team to update, develop and version UI scaffolding package separately from the primary framework and the main Laravel codebase.</p>
<p>Step 2 - Then do this:</p>
<p><code>php artisan ui bootstrap --auth</code>      <code>php artisan migrate</code>
or</p>
<p><code>php artisan ui vue --auth</code>   <code>php artisan migrate</code>
instead of</p>
<p><code>php artisan make:auth  ( which works for Laravel 5.8 and older versions )</code></p>
<p><code>npm install &amp;&amp; npm run dev</code></p>
<p><strong>php artisan migrateé”™è¯¯</strong></p>
<p><code>App\Providers\AppServiceProvider.php</code></p>
<p><code>use Illuminate\Support\Facades\Schema;</code></p>
<p><code>...</code></p>
<p><code>public function boot()</code>
<code>{</code>
<code>				Schema::defaultStringLength(191);</code>
<code>}</code></p>
<h3 id="ä½¿ç”¨dockerå®‰è£…laravel" tabindex="-1"> ä½¿ç”¨dockerå®‰è£…laravel</h3>
<p>å…ˆå®‰è£…dockerã€docker-composeå</p>
<div><pre><code><span>curl</span> <span>-s</span> https://laravel.build/example-app <span>|</span> <span>bash</span>

<span>curl</span> <span>-s</span> <span>"https://laravel.build/example-app?with=mysql,redis"</span> <span>|</span> <span>bash</span>
<span>#å¦‚æœä½ æ²¡æœ‰åˆ¶å®šä½ æƒ³é…ç½®çš„æœåŠ¡ï¼Œé»˜è®¤å°†é…ç½® mysqlï¼Œredisï¼Œmeilisearchï¼Œmailhog å’Œ selenium</span>

<span>cd</span> example-app

<span>#ç¼–è¯‘å¹¶å¯åŠ¨ï¼ˆå‰å°ï¼‰-då‚æ•°æ˜¯åå°å¯åŠ¨</span>
./vendor/bin/sail up
./vendor/bin/sail up <span>-d</span>

<span>#å¯åŠ¨</span>
./vendor/bin/sail start
<span>#åœæ­¢</span>
./vendor/bin/sail stop


</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>PHP</title>
      <link>https://doflam-z.github.io/php/php.html</link>
      <guid>https://doflam-z.github.io/php/php.html</guid>
      <source url="https://doflam-z.github.io/rss.xml">PHP</source>
      <pubDate>Mon, 24 Mar 2025 02:00:00 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="php" tabindex="-1"> PHP</h1>
<h3 id="å¸¸ç”¨å‡½æ•°" tabindex="-1"> å¸¸ç”¨å‡½æ•°</h3>
<div><pre><code>parse_str â€” å°†å­—ç¬¦ä¸²è§£ææˆå¤šä¸ªå˜é‡
<span>parse_str</span><span>(</span><span>"name=Bill&amp;age=60"</span><span>,</span><span>$arr</span><span>)</span><span>;</span><span>//ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªä¸ºç»“æœæ•°ç»„</span>

<span>array_filter</span><span>(</span> <span>array</span> <span>$input</span><span>[</span><span>,</span> <span>callable</span> <span>$callback</span> <span>=</span> <span>""</span><span>]</span> <span>)</span> 
<span>// ç”¨å›è°ƒå‡½æ•°è¿‡æ»¤æ•°ç»„ä¸­çš„å•å…ƒ ä¾æ¬¡å°† input æ•°ç»„ä¸­çš„æ¯ä¸ªå€¼ä¼ é€’åˆ° callback å‡½æ•°ã€‚å¦‚æœ callback å‡½æ•°è¿”å› TRUEï¼Œåˆ™ input æ•°ç»„çš„å½“å‰å€¼ä¼šè¢«åŒ…å«åœ¨è¿”å›çš„ç»“æœæ•°ç»„ä¸­ã€‚æ•°ç»„çš„é”®åä¿ç•™ä¸å˜ï¼Œå¦‚æœæ²¡æœ‰æä¾› callback å‡½æ•°ï¼Œå°†åˆ é™¤ input ä¸­æ‰€æœ‰ç­‰å€¼ä¸º FALSE çš„æ¡ç›®</span>

explode <span>//ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²åˆ†å‰²å¦ä¸€ä¸ªå­—ç¬¦ä¸²</span>
range <span>//å»ºç«‹ä¸€ä¸ªæŒ‡å®šèŒƒå›´çš„æ•°ç»„</span>
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="fpm" tabindex="-1"> fpm</h3>
<div><pre><code><span>#1ã€æŸ¥çœ‹php-fpmçš„è¿›ç¨‹ä¸ªæ•°</span>
<span>ps</span> <span>-ef</span> <span>|</span><span>grep</span> <span>"php-fpm"</span><span>|</span><span>grep</span> <span>"pool"</span><span>|</span><span>wc</span> <span>-l</span>
<span>#2ã€æŸ¥çœ‹æ¯ä¸ªphp-fpmå ç”¨çš„å†…å­˜å¤§å°</span>
<span>ps</span> <span>-ylC</span> php-fpm <span>--sort:rss</span>
<span>#3.æŸ¥çœ‹PHP-FPMåœ¨ä½ çš„æœºå™¨ä¸Šçš„å¹³å‡å†…å­˜å ç”¨</span>
<span>ps</span> --no-headers <span>-o</span> <span>"rss,cmd"</span> <span>-C</span> php-fpm <span>|</span> <span>awk</span> <span>'{ sum+=$1 } END { printf ("%d%s\n", sum/NR/1024,"M") }'</span>
<span>#4.æŸ¥çœ‹å•ä¸ªphp-fpmè¿›ç¨‹æ¶ˆè€—å†…å­˜çš„æ˜ç»†</span>
pmap <span><span>$(</span>pgrep php-fpm<span>)</span></span> <span>|</span> <span>less</span>


<span>#æŸ¥çœ‹phpã€nginxç¼–è¯‘å‚æ•°</span>
nginx <span>-V</span>
php <span>-i</span> <span>|</span><span>grep</span> configure

<span>#grepä¸è¾“å‡ºæ³¨é‡Šçš„è¡Œ</span>
<span>grep</span> <span>"^[^#;]"</span> smb.conf

</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>é‡å¯å¤šä¸ªphp-fpm</p>
<div><pre><code><span>#php-fpmæ·»åŠ serviceæœåŠ¡</span>
<span>cp</span> /usr/local/src/php5.6.40/sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm

update-rc.d php-fpm defaults
 
<span># æ·»åŠ </span>
update-rc.d ServiceName defaults
 
<span># åˆ é™¤</span>
update-rc.d ServiceName remove

<span>#å…³é—­php-fpm</span>
<span>pkill</span> php-fpm æˆ–è€… <span>killall</span> php-fpm

<span>#æŸ¥çœ‹php-fpmé…ç½®æ–‡ä»¶è·¯å¾„</span>
<span>ps</span> aux <span>|</span><span>grep</span> php-fpm

<span>#æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼Œæ‰¾åˆ°pidè·¯å¾„</span>
pid <span>=</span> /dev/shm/php-fpm-9001.pid

<span>#æ ¹æ®pidé‡å¯php-fpm</span>
<span>sudo</span> <span>kill</span> <span>-USR2</span> <span><span>`</span><span>cat</span> /dev/shm/php-fpm-9001.pid<span>`</span></span>

</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="phpå¤šçº¿ç¨‹" tabindex="-1"> phpå¤šçº¿ç¨‹</h3>
<p>å¼€å¯parallelå¤šçº¿ç¨‹æ‰©å±• --enable-maintainer-zts</p>
<div><pre><code><span>#parallel</span>
 <span>cd</span> /usr/local/src/php7/parallel-1.1.4 <span>&amp;&amp;</span> <span>\</span>
 /web/software/php-7.4.28/bin/phpize <span>&amp;&amp;</span> <span>\</span>
 ./configure --with-php-config<span>=</span>/web/software/php-7.4.28/bin/php-config <span>&amp;&amp;</span> <span>\</span>
 <span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span>
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div></div></div><p>ç¤ºä¾‹ï¼š</p>
<div><pre><code><span><span>&lt;?php</span>
<span>require_once</span> <span>'baseClassV4/listen/BaseCache.php'</span><span>;</span>
<span>$redis</span> <span>=</span> <span>new</span> <span>BaseCache</span> <span>(</span><span>'redis'</span><span>,</span> <span>'default'</span><span>)</span><span>;</span>
<span>$startTime</span> <span>=</span> <span>time</span><span>(</span><span>)</span><span>;</span>
<span>$num</span> <span>=</span> <span>10</span><span>;</span>
<span>$j</span> <span>=</span> <span>0</span><span>;</span>
<span>$list</span> <span>=</span> <span>range</span><span>(</span><span>0</span><span>,</span> <span>1000</span><span>)</span><span>;</span>
<span>$path</span> <span>=</span> <span>'baseClassV4/listen/BaseCache.php'</span><span>;</span>

<span>$producer</span> <span>=</span> <span>function</span> <span>(</span><span>$parameters</span><span>)</span> <span>{</span> <span>// çº¿ç¨‹è°ƒç”¨å›è°ƒå‡½æ•°ä½“</span>
	<span>$i</span> <span>=</span> <span>0</span><span>;</span>
	<span>extract</span><span>(</span><span>$parameters</span><span>)</span><span>;</span> 
	<span>foreach</span> <span>(</span><span>$list</span> <span>as</span> <span>$item</span><span>)</span> <span>{</span>
		<span>$r</span> <span>=</span> <span>$redis</span><span>-></span><span>zIncrBy</span><span>(</span><span>'test'</span><span>,</span> <span>1</span><span>,</span> <span>$threadNum</span><span>)</span><span>;</span>
		<span>if</span> <span>(</span><span>$r</span> <span>></span> <span>0</span><span>)</span> <span>{</span>
			<span>$i</span><span>++</span><span>;</span>
		<span>}</span>
		<span>echo</span> <span>$threadNum</span> <span>.</span> <span>':'</span> <span>.</span> <span>$item</span> <span>.</span> <span>PHP_EOL</span><span>;</span>
		<span>usleep</span><span>(</span><span>10000</span><span>)</span><span>;</span>
	<span>}</span>
	<span>return</span> <span>$i</span><span>;</span>
<span>}</span><span>;</span>

<span>function</span> <span>start_threads</span><span>(</span><span>$list</span><span>,</span> <span>$producer</span><span>,</span> <span>$threadNum</span> <span>=</span> <span>1</span><span>,</span> <span>$parameters</span> <span>=</span> <span>[</span><span>]</span><span>,</span> <span>$path</span> <span>=</span> <span>''</span><span>,</span> <span>$sleep</span> <span>=</span> <span>1</span><span>)</span>
<span>{</span>
	<span>$list</span> <span>=</span> <span>array_chunk</span><span>(</span><span>$list</span><span>,</span> <span>count</span><span>(</span><span>$list</span><span>)</span> <span>/</span> <span>$threadNum</span><span>)</span><span>;</span>
	<span>foreach</span> <span>(</span><span>$list</span> <span>as</span> <span>$key</span> <span>=></span> <span>$item</span><span>)</span> <span>{</span>
		<span>$parameters</span><span>[</span><span>'list'</span><span>]</span> <span>=</span> <span>$item</span><span>;</span>
		<span>$parameters</span><span>[</span><span>'threadNum'</span><span>]</span> <span>=</span> <span>$key</span><span>;</span>
		<span>$threads</span><span>[</span><span>$key</span><span>]</span> <span>=</span> <span>(</span><span>new</span> <span><span>\</span>parallel<span>\</span>Runtime</span><span>(</span><span>$path</span><span>)</span><span>)</span><span>-></span><span>run</span><span>(</span><span>$producer</span><span>,</span> <span>[</span><span>$parameters</span><span>]</span><span>)</span><span>;</span>
	<span>}</span>

	<span>while</span> <span>(</span><span>!</span><span>empty</span><span>(</span><span>$threads</span><span>)</span><span>)</span> <span>{</span>
		<span>foreach</span> <span>(</span><span>$threads</span> <span>as</span> <span>$key</span> <span>=></span> <span>&amp;</span><span>$thread</span><span>)</span> <span>{</span>
			<span>if</span> <span>(</span><span>$thread</span><span>-></span><span>done</span><span>(</span><span>)</span><span>)</span> <span>{</span> <span>// æ£€æµ‹çº¿ç¨‹çŠ¶æ€ï¼Œè¿”å›trueæ—¶çº¿ç¨‹è¿è¡Œå®Œæ¯•</span>
				<span>$result</span> <span>=</span> <span>$thread</span><span>-></span><span>value</span><span>(</span><span>)</span><span>;</span> <span>// è·å–çº¿ç¨‹å†…å‡½æ•°æ‰§è¡Œè¿”å›çš„ç»“æœ</span>
				<span>echo</span> <span>"ThreadId: <span><span>$key</span></span> => result: <span><span>{</span><span>$result</span><span>}</span></span> (End)\n"</span><span>;</span>
				<span>unset</span><span>(</span><span>$threads</span><span>[</span><span>$key</span><span>]</span><span>)</span><span>;</span>
			<span>}</span>
		<span>}</span>
		<span>sleep</span><span>(</span><span>$sleep</span><span>)</span><span>;</span>
	<span>}</span>
<span>}</span>


<span>start_threads</span><span>(</span><span>$list</span><span>,</span> <span>$producer</span><span>,</span> <span>10</span><span>,</span> <span>[</span><span>'redis'</span> <span>=></span> <span>$redis</span><span>]</span><span>,</span> <span>$path</span><span>,</span> <span>1</span><span>)</span><span>;</span>
</span></code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>tp6ç¬”è®°</title>
      <link>https://doflam-z.github.io/php/tp6.html</link>
      <guid>https://doflam-z.github.io/php/tp6.html</guid>
      <source url="https://doflam-z.github.io/rss.xml">tp6ç¬”è®°</source>
      <pubDate>Mon, 24 Mar 2025 02:00:00 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="tp6ç¬”è®°" tabindex="-1"> tp6ç¬”è®°</h1>
<h3 id="å®‰è£…" tabindex="-1"> å®‰è£…</h3>
<p>å…ˆå®‰è£…composer</p>
<div><pre><code><span>curl</span> <span>-sS</span> https://getcomposer.org/installer <span>|</span> php
<span>mv</span> composer.phar /usr/local/bin/composer
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>å®‰è£…é¡¹ç›®</p>
<div><pre><code><span>composer</span> create-project topthink/think tp
</code></pre><div aria-hidden="true"><div></div></div></div><p>æµ‹è¯•è¿è¡Œ</p>
<div><pre><code>php think run
</code></pre><div aria-hidden="true"><div></div></div></div><p>å®‰è£…æ‰©å±•</p>
<div><pre><code><span>composer</span> require topthink/think-migration
</code></pre><div aria-hidden="true"><div></div></div></div><p>åˆ›å»ºæ–‡ä»¶</p>
<div><pre><code>php think migrate:create ArticleTable
</code></pre><div aria-hidden="true"><div></div></div></div><p>è¿›å…¥databaseç›®å½•ä¿®æ”¹ä»£ç </p>
<div><pre><code>public <span>function</span> <span>change</span><span>(</span><span>)</span>
<span>{</span>
    // create the table
    <span>$table</span>  <span>=</span>  <span>$this</span>-<span>></span>table<span>(</span><span>'article'</span><span>)</span><span>;</span>
    <span>$table</span>-<span>></span>addColumn<span>(</span><span>'title'</span>, <span>'string'</span>, <span>[</span><span>'comment'</span> <span>=</span><span>></span> <span>'æ–‡ç« æ ‡é¢˜'</span><span>]</span><span>)</span>
    -<span>></span>addColumn<span>(</span><span>'body'</span>, <span>'text'</span>, <span>[</span><span>'comment'</span> <span>=</span><span>></span> <span>'æ–‡ç« å†…å®¹'</span><span>]</span><span>)</span>
    -<span>></span>addTimestamps<span>(</span><span>)</span>
    -<span>></span>create<span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>è¿è¡Œå»ºè¡¨</p>
<div><pre><code>php think migrate:run
</code></pre><div aria-hidden="true"><div></div></div></div><p>ç”Ÿæˆæ§åˆ¶å™¨ã€æ¨¡å‹</p>
<div><pre><code> php think make:controller index@Demo 
 php think make:model Demo
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>å®‰è£…åŒ…</p>
<div><pre><code>composer install --ignore-platform-reqs
</code></pre><div aria-hidden="true"><div></div></div></div><h4 id="å¤šåº”ç”¨" tabindex="-1"> å¤šåº”ç”¨</h4>
<p>å®‰è£…å¤šåº”ç”¨æ‰©å±•ï¼Œåˆ›å»ºåº”ç”¨ç›®å½•</p>
<div><pre><code><span>composer</span> require topthink/think-multi-app 
php think build adimn
</code></pre><div aria-hidden="true"><div></div><div></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>Pythonç¬”è®°</title>
      <link>https://doflam-z.github.io/python/Python.html</link>
      <guid>https://doflam-z.github.io/python/Python.html</guid>
      <source url="https://doflam-z.github.io/rss.xml">Pythonç¬”è®°</source>
      <pubDate>Mon, 24 Mar 2025 02:00:00 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="pythonç¬”è®°" tabindex="-1"> Pythonç¬”è®°</h1>
<h3 id="pipå¯¼å‡ºã€å®‰è£…ä¾èµ–" tabindex="-1"> PIPå¯¼å‡ºã€å®‰è£…ä¾èµ–</h3>
<div><pre><code>pip freeze <span>></span> requirements.txt
pip <span>install</span> <span>-r</span> requirements.txt
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><h3 id="ä½¿ç”¨-pyenv-å®‰è£…ç®¡ç†å¤šä¸ª-pythonç‰ˆæœ¬" tabindex="-1"> ä½¿ç”¨ pyenv å®‰è£…ç®¡ç†å¤šä¸ª Pythonç‰ˆæœ¬</h3>
<p><strong>pyenv çš„ä½œç”¨</strong></p>
<p>pyenv æ˜¯ä¸€ä¸ª <strong>Python ç‰ˆæœ¬ç®¡ç†å·¥å…·</strong>ï¼Œå¯ä»¥è®©ä½ è½»æ¾åœ°åœ¨åŒä¸€å°æœºå™¨ä¸Šå®‰è£…å’Œåˆ‡æ¢å¤šä¸ª Python ç‰ˆæœ¬ï¼Œè€Œä¸ä¼šå½±å“ç³»ç»Ÿè‡ªå¸¦çš„ Pythonã€‚</p>
<p><strong>ğŸ’¡ pyenv èƒ½åšä»€ä¹ˆï¼Ÿ</strong></p>
<p><strong>1ï¸âƒ£ åœ¨åŒä¸€å°ç”µè„‘ä¸Šå®‰è£…å¤šä¸ª Python ç‰ˆæœ¬</strong></p>
<p>æ¯”å¦‚ä½ çš„ç³»ç»Ÿé»˜è®¤æ˜¯ Python 3.8ï¼Œä½†ä½ æƒ³åœ¨ä¸åŒé¡¹ç›®ä¸­ä½¿ç”¨ Python 3.10 æˆ– 3.12ï¼Œå°±å¯ä»¥ç”¨ pyenv è½»æ¾ç®¡ç†ï¼š</p>
<div><pre><code>pyenv install 3.10.13
pyenv install 3.12.1
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p><strong>2ï¸âƒ£ è®©ä¸åŒé¡¹ç›®ä½¿ç”¨ä¸åŒçš„ Python ç‰ˆæœ¬</strong></p>
<p>ä½ å¯ä»¥ä¸ºæ¯ä¸ªé¡¹ç›®æŒ‡å®šä¸åŒçš„ Python ç‰ˆæœ¬ï¼Œé¿å…å…¼å®¹æ€§é—®é¢˜ï¼š</p>
<div><pre><code>cd my_project
pyenv local 3.10.13  # è¿™ä¸ªé¡¹ç›®ç”¨ Python 3.10
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>å¦ä¸€ä¸ªé¡¹ç›®å¯ä»¥ä½¿ç”¨ Python 3.12ï¼š</p>
<div><pre><code>cd another_project
pyenv local 3.12.1  # è¿™ä¸ªé¡¹ç›®ç”¨ Python 3.12
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>è¿™æ ·ï¼Œæ¯ä¸ªé¡¹ç›®çš„ Python ç‰ˆæœ¬éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šäº’ç›¸å¹²æ‰°ã€‚</p>
<p><strong>3ï¸âƒ£ æ›¿æ¢ç³»ç»Ÿé»˜è®¤çš„ Python</strong></p>
<p>åœ¨ä¸æ”¹åŠ¨ç³»ç»Ÿè‡ªå¸¦ Python çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨è‡ªå·±å®‰è£…çš„ Python ç‰ˆæœ¬ï¼š</p>
<div><pre><code>pyenv global 3.12.1  # è®©æ•´ä¸ªç”¨æˆ·ç¯å¢ƒé»˜è®¤ä½¿ç”¨ Python 3.12.1
</code></pre><div aria-hidden="true"><div></div></div></div><p>å¦‚æœæƒ³æ¢å¤ç³»ç»Ÿé»˜è®¤çš„ Pythonï¼š</p>
<div><pre><code>pyenv global system
</code></pre><div aria-hidden="true"><div></div></div></div><p><strong>4ï¸âƒ£ è§£å†³ sudo apt install python3-distutils æ‰¾ä¸åˆ°çš„é—®é¢˜</strong></p>
<p>æœ‰æ—¶å€™ Ubuntu å®˜æ–¹çš„è½¯ä»¶åº“æ²¡æœ‰æä¾›æœ€æ–°çš„ Python ç‰ˆæœ¬æˆ–è€…æŸäº›ç»„ä»¶ï¼ˆå¦‚ distutilsï¼‰ã€‚ç”¨ pyenv å®‰è£… Python å¯ä»¥ç»•å¼€è¿™ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p>
<div><pre><code>pyenv install 3.11.6  # å®‰è£… Python 3.11.6
pyenv global 3.11.6  # è®¾ä¸ºé»˜è®¤ Python ç‰ˆæœ¬
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>ç„¶åä½ å°±å¯ä»¥ä½¿ç”¨ pip æ­£å¸¸å®‰è£… lxml äº†ï¼š</p>
<div><pre><code>pip install lxml
</code></pre><div aria-hidden="true"><div></div></div></div><hr>
<p><strong>ğŸš€ pyenv å®‰è£… &amp; ä½¿ç”¨</strong></p>
<p><strong>1ï¸âƒ£ å®‰è£… pyenv</strong></p>
<p><strong>ğŸ”¹ Ubuntu / Debian</strong></p>
<div><pre><code>curl https://pyenv.run | bash
</code></pre><div aria-hidden="true"><div></div></div></div><p>ç„¶åæ·»åŠ ä»¥ä¸‹å†…å®¹åˆ° ~/.bashrc æˆ– ~/.bash_profileï¼š</p>
<div><pre><code>export PATH="$HOME/.pyenv/bin:$PATH"
eval "$(pyenv init --path)"
eval "$(pyenv virtualenv-init -)"
</code></pre><div aria-hidden="true"><div></div><div></div><div></div></div></div><p>ç„¶åè¿è¡Œï¼š</p>
<div><pre><code>exec $SHELL  # é‡æ–°åŠ è½½ shell
</code></pre><div aria-hidden="true"><div></div></div></div><p><strong>ğŸ”¹ Macï¼ˆä½¿ç”¨ Homebrew å®‰è£…ï¼‰</strong></p>
<div><pre><code>brew install pyenv
echo 'eval "$(pyenv init --path)"' >> ~/.zshrc
source ~/.zshrc
</code></pre><div aria-hidden="true"><div></div><div></div><div></div></div></div><p><strong>2ï¸âƒ£ ä½¿ç”¨ pyenv å®‰è£… Python</strong></p>
<div><pre><code>pyenv install 3.12.1
pyenv global 3.12.1
python --version  # ç¡®ä¿ä½¿ç”¨çš„æ˜¯ pyenv ç‰ˆæœ¬
</code></pre><div aria-hidden="true"><div></div><div></div><div></div></div></div><p><strong>ğŸ› ï¸ æ€»ç»“</strong></p>
<p>ğŸ”¹ <strong>pyenv = Python ç‰ˆæœ¬ç®¡ç†å™¨</strong>ï¼Œè®©ä½ å¯ä»¥å®‰è£…ã€åˆ‡æ¢å¤šä¸ª Python ç‰ˆæœ¬ã€‚</p>
<p>ğŸ”¹ <strong>é¿å…ç ´åç³»ç»Ÿ Python</strong>ï¼Œä¸ä¼šå½±å“ apt æˆ– yum ç®¡ç†çš„ Pythonã€‚</p>
<p>ğŸ”¹ <strong>è§£å†³ä¾èµ–é—®é¢˜</strong>ï¼Œå¦‚ distutils ç¼ºå¤±ã€pip ç‰ˆæœ¬å†²çªç­‰ã€‚</p>
<p>ğŸ”¹ <strong>æ¯ä¸ªé¡¹ç›®å¯ä»¥æœ‰è‡ªå·±çš„ Python ç‰ˆæœ¬</strong>ï¼Œé¿å…ä¸åŒ Python ç‰ˆæœ¬çš„å…¼å®¹æ€§é—®é¢˜ã€‚</p>
<h3 id="python-ç¼–è¯‘ç¼ºå¤±äº†å¤šä¸ªé‡è¦æ¨¡å—" tabindex="-1"> Python ç¼–è¯‘ç¼ºå¤±äº†å¤šä¸ªé‡è¦æ¨¡å—</h3>
<blockquote>
<p>Python ç¼–è¯‘ç¼ºå¤±äº†å¤šä¸ªé‡è¦æ¨¡å—ï¼ŒåŒ…æ‹¬ _cursesï¼ˆncursesï¼‰ã€readlineï¼ˆGNU Readlineï¼‰ã€_sqlite3ï¼ˆSQLite3ï¼‰å’Œ _lzmaï¼ˆLZMAï¼‰ã€‚è¿™äº›é—®é¢˜é€šå¸¸æ˜¯å› ä¸ºç¼ºå°‘å¿…è¦çš„ ç³»ç»Ÿä¾èµ–ï¼Œæ‰€ä»¥ä½ éœ€è¦å®‰è£…å®ƒä»¬åé‡æ–°ç¼–è¯‘ Pythonã€‚</p>
</blockquote>
<p>è§£å†³æ–¹æ¡ˆ</p>
<ol>
<li>å®‰è£…ç¼ºå¤±çš„ç³»ç»Ÿä¾èµ–</li>
</ol>
<p>åœ¨ Ubuntu/Debian ä¸Šè¿è¡Œï¼š</p>
<div><pre><code><span>sudo</span> <span>apt</span> update <span>&amp;&amp;</span> <span>sudo</span> <span>apt</span> <span>install</span> <span>-y</span> <span>\</span>
    libbz2-dev <span>\</span>
    liblzma-dev <span>\</span>
    libsqlite3-dev <span>\</span>
    libncurses5-dev <span>\</span>
    libncursesw5-dev <span>\</span>
    libreadline-dev <span>\</span>
    xz-utils <span>\</span>
    tk-dev
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>åœ¨ CentOS/RHEL ä¸Šï¼š</p>
<div><pre><code><span>sudo</span> yum <span>install</span> <span>-y</span> <span>\</span>
    bzip2-devel <span>\</span>
    xz-devel <span>\</span>
    sqlite-devel <span>\</span>
    ncurses-devel <span>\</span>
    readline-devel <span>\</span>
    xz <span>\</span>
    tk-devel
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><ol start="2">
<li>å¼ºåˆ¶é‡æ–°ç¼–è¯‘ Python</li>
</ol>
<p>å®‰è£…å®Œä¾èµ–åï¼Œé‡æ–°ç¼–è¯‘ Pythonï¼š</p>
<div><pre><code><span>CFLAGS</span><span>=</span><span>"-I/usr/include -I/usr/include/bz2 -I/usr/include/lzma -I/usr/include/ncurses -I/usr/include/readline -I/usr/include/sqlite3"</span> <span>\</span>
pyenv <span>install</span> <span>3.9</span>.7 <span>--force</span>
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><ol start="3">
<li>æ¿€æ´» Python å¹¶æ£€æŸ¥æ¨¡å—</li>
</ol>
<p>å®‰è£…å®Œæˆåï¼Œæ£€æŸ¥ Python æ˜¯å¦æ­£ç¡®ç¼–è¯‘äº†æ‰€æœ‰æ¨¡å—ï¼š</p>
<div><pre><code>pyenv <span>local</span> <span>3.9</span>.7

python3 <span>-c</span> <span>"import bz2, lzma, sqlite3, readline, curses"</span>
</code></pre><div aria-hidden="true"><div></div><div></div><div></div></div></div><p>å¦‚æœæ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜ä¸€åˆ‡æ­£å¸¸ï¼</p>
<h3 id="å®‰è£…virtualenvè™šæ‹Ÿç¯å¢ƒ" tabindex="-1"> å®‰è£…virtualenvè™šæ‹Ÿç¯å¢ƒ</h3>
<p>å®‰è£…virtualenv</p>
<div><pre><code>pip3 <span>install</span> virtualenv
</code></pre><div aria-hidden="true"><div></div></div></div><p>åˆ›å»ºé¡¹ç›®ç›®å½•appåŒæ—¶åˆ›å»ºä¸€ä¸ªåä¸ºvenvçš„è™šæ‹Ÿç¯å¢ƒï¼Œè¿›å…¥ç¯å¢ƒ</p>
<div><pre><code><span>#mac</span>
pip <span>install</span> virtualenv
python3 <span>-m</span> venv venv
<span>source</span> venv/bin/activate

<span>#win</span>
<span>#æ‰“å¼€å‘½ä»¤è¡Œè¾“å…¥ Set-ExecutionPolicy RemoteSigned</span>
pip <span>install</span> virtualenv
pip <span>install</span> virtualenvwrapper
<span>cd</span> app
virtualenv venv
<span>#è¿›å…¥è™šæ‹Ÿç¯å¢ƒ</span>
.<span>\</span>venv<span>\</span>Scripts<span>\</span>activate
<span>#ç¦»å¼€è™šæ‹Ÿç¯å¢ƒ</span>
.<span>\</span>venv<span>\</span>Scripts<span>\</span>deactivate
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>é€€å‡ºè™šæ‹Ÿç¯å¢ƒ</p>
<div><pre><code>deactivate
</code></pre><div aria-hidden="true"><div></div></div></div><h3 id="å®‰è£…scrapy" tabindex="-1"> å®‰è£…Scrapy</h3>
<div><pre><code><span>#å…ˆå®‰è£…ä¾èµ–</span>
pip <span>install</span> wheel lxml pyOpenSSL Twisted
pip <span>install</span> <span>install</span> Scrapy

<span># æˆ–è€…ç›´æ¥å¯¼å…¥ä¾èµ–æ–‡æœ¬</span>
pip <span>install</span> <span>-r</span> requirements.txt

<span>#åˆ›å»ºé¡¹ç›®</span>
scrapy startproject tutorial

<span>#åˆ›å»ºç¬¬ä¸€ä¸ªçˆ¬è™«æ–‡ä»¶ï¼ŒæŒ‡å®šåŸŸå</span>
scrapy genspider zhipin <span>"zhipin.com"</span>

<span>#åˆ›å»ºä¸€ä¸ªXMLFeedSpiderçˆ¬è™«æ–‡ä»¶</span>
scrapy genspider <span>-t</span> xmlfeed lagou lagou.com

<span>#è¿è¡Œä¸€ä¸ªçˆ¬è™«ç¨‹åºï¼Œè¾“å‡ºåˆ°æ–‡ä»¶</span>
scrapy crawl mininova <span>-o</span> scraped_data.json 

<span>#è¿è¡Œä¸€ä¸ªçˆ¬è™«ç¨‹åºï¼Œå°†æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šç›®å½•</span>
scrpay crawl spider_name  <span>-s</span> <span>LOG_FILE</span><span>=</span>all.log

<span>#é…ç½®æ–‡ä»¶settings.py</span>
<span>#å¼€å¯ä¸‹è½½å™¨ä¸­é—´ä»¶ï¼Œæ•°å€¼è¶Šå°è¶Šæ¥è¿‘æ§åˆ¶å™¨</span>
DOWNLOADER_MIDDLEWARES <span>=</span> <span>{</span>
    <span>'companyProfile.middlewares.CompanyprofileDownloaderMiddleware'</span><span>:</span> None,
    <span>'companyProfile.middlewares.AgentDownloaderMiddleware'</span><span>:</span> <span>543</span>,
    <span>'companyProfile.middlewares.SeleniumDownloaderMiddleware'</span><span>:</span> <span>643</span>,
<span>}</span>

<span>#å¼€å¯ç®¡é“</span>
ITEM_PIPELINES <span>=</span> <span>{</span>
   <span>'companyProfile.pipelines.CompanyprofilePipeline'</span><span>:</span> <span>300</span>,
<span>}</span>


</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="seleniuméœ€è¦chromeé©±åŠ¨" tabindex="-1"> seleniuméœ€è¦chromeé©±åŠ¨</h3>
<div><pre><code><span># å®‰è£…chrome</span>
<span>sudo</span> <span>wget</span> https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
<span>sudo</span> <span>apt</span> <span>install</span> ./google-chrome-stable_current_amd64.deb
<span># ä¸‹è½½é©±åŠ¨</span>
<span>sudo</span> <span>wget</span> https://chromedriver.storage.googleapis.com/101.0.4951.41/chromedriver_linux64.zip
<span># è§£å‹ç›´æ¥ä½¿ç”¨</span>
<span>sudo</span> <span>unzip</span> chromedriver_linux64.zip
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="å®‰è£…çˆ¬è™«éœ€è¦çš„åº“" tabindex="-1"> å®‰è£…çˆ¬è™«éœ€è¦çš„åº“</h3>
<div><pre><code> pip <span>install</span> beautifulsoup4 
 pip <span>install</span> requests
 pip <span>install</span> selenium
 pip <span>install</span> fake-useragent
 pip <span>install</span> redis
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="å®‰è£…mysql-peewee-ormåº“" tabindex="-1"> å®‰è£…mysql peewee ORMåº“</h3>
<div><pre><code>pip <span>install</span> pymysql
pip <span>install</span> peewee
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><h5 id="peeweeç”Ÿæˆmoduleæ–‡ä»¶" tabindex="-1"> peeweeç”Ÿæˆmoduleæ–‡ä»¶</h5>
<div><pre><code>python <span>-m</span> pwiz <span>-e</span> mysql <span>-H</span> localhost <span>-p</span> <span>3306</span> <span>-u</span> æ•°æ®åº“ç”¨æˆ·å <span>-P</span> æ•°æ®åº“å¯†ç  <span>-t</span> è¡¨å<span>(</span>table name<span>)</span> åº“å<span>(</span>database name<span>)</span> <span>></span> è¦ç”Ÿæˆçš„pythonæ–‡ä»¶åç§°.py
python <span>-m</span> pwiz <span>-e</span> mysql <span>-H</span> <span>192.168</span>.1.14 <span>-p</span> <span>3306</span> <span>-u</span> jobSnatch_r <span>-P</span> <span>-t</span> tb_company_info jobui_snatch_company <span>></span> tb_company_info.py

python <span>-m</span> pwiz <span>-e</span> mysql <span>-H</span> <span>192.168</span>.1.14 <span>-p</span> <span>3306</span> <span>-u</span> jobSnatch_r <span>-P</span> <span>-t</span> tb_company_content jobui_snatch_company <span>></span> tb_company_info.py

python <span>-m</span> pwiz <span>-e</span> mysql <span>-H</span> <span>121.9</span>.201.145 <span>-p</span> <span>3307</span> <span>-u</span> jobSnatch_w <span>-P</span> <span>-t</span> tb_company_status jobui_snatch_company <span>></span> tb_company_status.py
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>ç”Ÿæˆçš„æ–‡ä»¶éœ€è¦è½¬æˆutf-8æ–‡ä»¶æ ¼å¼</p>
<div><pre><code>database = MySQLDatabase('jobui_snatch_company', host="192.168.1.14", user='jobSnatch_r', passwd='j89#do@k', port=3306)
</code></pre><div aria-hidden="true"><div></div></div></div><div><pre><code>database = MySQLDatabase('jobui_snatch_company', host="192.168.1.14", user='jobSnatch_r', passwd='j89#do@k', port=3306)
</code></pre><div aria-hidden="true"><div></div></div></div><h3 id="å®‰è£…mongodb-ormåº“" tabindex="-1"> å®‰è£…mongodb ORMåº“</h3>
<div><pre><code><span>#å®‰è£…pymongo3.12.3ï¼Œæœ€æ–°ç‰ˆæœ¬éªŒè¯ä¼šæŠ¥é”™</span>
pip install  pymongo<span>==</span><span>3.12</span><span>.3</span>
<span>#å®‰è£…MongoEngine</span>
python <span>-</span>m pip install mongoengine

<span>#è¿æ¥</span>
<span>from</span> mongoengine <span>import</span> <span>*</span>
<span>from</span> env <span>import</span> <span>*</span>

db <span>=</span> <span>'jobui_tmp'</span>
config <span>=</span> Env<span>.</span>get_db_config<span>(</span>db<span>)</span>
connect<span>(</span>db<span>,</span> <span>**</span>config<span>)</span>


<span>class</span> <span>CompanyProfile</span><span>(</span>Document<span>)</span><span>:</span>
    _id <span>=</span> IntField<span>(</span>primary_key<span>=</span><span>True</span><span>)</span>  <span># å…¬å¸id</span>
    name <span>=</span> StringField<span>(</span><span>)</span>  <span># å…¬å¸å</span>
    domain <span>=</span> StringField<span>(</span><span>)</span>  <span># æ¥æºç½‘å€</span>
    content <span>=</span> StringField<span>(</span><span>)</span>  <span># å…¬å¸ä»‹ç»</span>

    meta <span>=</span> <span>{</span>
        <span>'indexes'</span><span>:</span> <span>[</span>  <span># å»ºç´¢å¼•</span>
            <span>'name'</span><span>,</span>
            <span>'domain'</span><span>,</span>
            <span>'content'</span>
        <span>]</span>
    <span>}</span>

<span>##å¦‚æœæœ‰ä¸»é”®å­—æ®µï¼Œåˆ™ä¸»é”®å­—æ®µä¸èƒ½è®¾ç½®ä¸ºAutoFieldç±»å‹ï¼Œä¼šå¯¼è‡´æ’å…¥è¯­å¥å¼‚å¸¸</span>
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>shell</title>
      <link>https://doflam-z.github.io/linux/shell.html</link>
      <guid>https://doflam-z.github.io/linux/shell.html</guid>
      <source url="https://doflam-z.github.io/rss.xml">shell</source>
      <pubDate>Fri, 21 Mar 2025 02:03:08 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="shell" tabindex="-1"> shell</h1>
<h3 id="æŸ¥çœ‹ç³»ç»Ÿå½“å‰ä½¿ç”¨çš„shellã€æŸ¥çœ‹ç³»ç»Ÿæœ‰å“ªäº›shell" tabindex="-1"> æŸ¥çœ‹ç³»ç»Ÿå½“å‰ä½¿ç”¨çš„shellã€æŸ¥çœ‹ç³»ç»Ÿæœ‰å“ªäº›shell</h3>
<div><pre><code><span>echo</span> <span>$SHELL</span>
<span>cat</span> /etc/shells
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><h3 id="å®‰è£…zsh" tabindex="-1"> å®‰è£…zsh</h3>
<div><pre><code><span>sudo</span> <span>apt</span> <span>install</span> <span>zsh</span> <span>-y</span>
</code></pre><div aria-hidden="true"><div></div></div></div><blockquote>
<p>è®¾ç½®ä¸ºé»˜è®¤shell</p>
</blockquote>
<div><pre><code>chsh <span>-s</span> /bin/zsh
</code></pre><div aria-hidden="true"><div></div></div></div><h3 id="å®‰è£…oh-my-zsh" tabindex="-1"> å®‰è£…oh my zsh</h3>
<div><pre><code><span>sh</span> <span>-c</span> <span>"<span><span>$(</span><span>curl</span> <span>-fsSL</span> https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh<span>)</span></span>"</span>
</code></pre><div aria-hidden="true"><div></div></div></div><h3 id="é…ç½®ä¸»é¢˜" tabindex="-1"> é…ç½®ä¸»é¢˜</h3>
<blockquote>
<p>å°† <code>ZSH_THEME=&quot;robbyrussell&quot;</code> ä¿®æ”¹ä¸º <code>ZSH_THEME=&quot;ys&quot;</code> ï¼Œysè¿™ä¸ªä¸»é¢˜æ¯”è¾ƒç®€çº¦,ä¿®æ”¹ä¹‹åé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ <code>source ~/.zshrc</code>ä¸»é¢˜é“¾æ¥https://github.com/ohmyzsh/ohmyzsh/wiki/Themes</p>
</blockquote>
<p>å®‰è£… <strong>Oh My Zsh</strong>ï¼ˆæ¨èï¼‰</p>
<div><pre><code>sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
</code></pre><div aria-hidden="true"><div></div></div></div><p>ä¸‹è½½ Powerlevel10k ä¸»é¢˜ï¼š</p>
<div><pre><code>git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k
</code></pre><div aria-hidden="true"><div></div></div></div><p>ç¼–è¾‘ ~/.zshrc æ–‡ä»¶ï¼š</p>
<div><pre><code>ZSH_THEME="powerlevel10k/powerlevel10k"
</code></pre><div aria-hidden="true"><div></div></div></div><p>é‡æ–°åŠ è½½é…ç½®ï¼š</p>
<div><pre><code>source ~/.zshrc
</code></pre><div aria-hidden="true"><div></div></div></div><h3 id="å®‰è£…æ’ä»¶" tabindex="-1"> å®‰è£…æ’ä»¶</h3>
<blockquote>
<p>å®‰è£…å‘½ä»¤è¡¥å…¨ã€å‘½ä»¤é«˜äº®æ˜¾ç¤ºæ’ä»¶</p>
</blockquote>
<p>ä¸‹è½½</p>
<div><pre><code><span>git</span> clone https://github.com/zsh-users/zsh-autosuggestions <span>${ZSH_CUSTOM<span>:-</span>$HOME<span>/</span>.oh-my-zsh<span>/</span>custom}</span>/plugins/zsh-autosuggestions

<span>git</span> clone https://github.com/zsh-users/zsh-syntax-highlighting <span>${ZSH_CUSTOM<span>:-</span>~<span>/</span>.oh-my-zsh<span>/</span>custom}</span>/plugins/zsh-syntax-highlighting
</code></pre><div aria-hidden="true"><div></div><div></div><div></div></div></div><p>å¼€å¯</p>
<div><pre><code><span>vi</span> ~/.zshrc
<span># å¼€å¯æ’ä»¶</span>
<span>plugins</span><span>=</span><span>(</span>git z zsh-syntax-highlighting zsh-autosuggestions<span>)</span>
</code></pre><div aria-hidden="true"><div></div><div></div><div></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>network</title>
      <link>https://doflam-z.github.io/linux/network.html</link>
      <guid>https://doflam-z.github.io/linux/network.html</guid>
      <source url="https://doflam-z.github.io/rss.xml">network</source>
      <pubDate>Mon, 26 Feb 2024 10:08:55 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="network" tabindex="-1"> network</h1>
<blockquote>
<p>ç½‘ç»œç›¸å…³å‘½ä»¤</p>
</blockquote>
<h3 id="æŸ¥çœ‹ç½‘ç»œå®æ—¶æµé‡" tabindex="-1"> æŸ¥çœ‹ç½‘ç»œå®æ—¶æµé‡</h3>
<div><pre><code><span>sudo</span> iftop <span>-i</span> eno3
</code></pre><div aria-hidden="true"><div></div></div></div><blockquote>
<p>-i æŒ‡å®šç½‘å¡</p>
</blockquote>
<h3 id="æŸ¥çœ‹tcpã€udpè¿æ¥æ•°" tabindex="-1"> æŸ¥çœ‹tcpã€udpè¿æ¥æ•°</h3>
<div><pre><code><span>sudo</span> <span>netstat</span> <span>-an</span> <span>|</span> <span>grep</span> tcp <span>|</span> <span>wc</span> <span>-l</span>
<span>sudo</span> <span>netstat</span> <span>-anu</span> <span>|</span> <span>grep</span> udp <span>|</span> <span>wc</span> <span>-l</span>
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><blockquote>
<p>è¿™ä¸ªå‘½ä»¤çš„å«ä¹‰æ˜¯ï¼š</p>
<ul>
<li><code>netstat -an</code>ï¼šåˆ—å‡ºç³»ç»Ÿä¸Šçš„æ‰€æœ‰ç½‘ç»œè¿æ¥ï¼ŒåŒ…æ‹¬ TCP å’Œ UDP è¿æ¥ã€‚</li>
<li><code>grep tcp</code>ï¼šç­›é€‰å‡º TCP è¿æ¥çš„è¡Œã€‚</li>
<li><code>wc -l</code>ï¼šå¯¹ç­›é€‰åçš„è¡Œæ•°è¿›è¡Œç»Ÿè®¡ï¼Œå³è®¡ç®— TCP è¿æ¥çš„æ•°é‡</li>
</ul>
</blockquote>
<h3 id="æŸ¥çœ‹tcpé”™è¯¯æ•°" tabindex="-1"> æŸ¥çœ‹tcpé”™è¯¯æ•°</h3>
<div><pre><code><span>sudo</span> <span>netstat</span> <span>-s</span> <span>|</span> <span>grep</span> <span>-i</span> error
</code></pre><div aria-hidden="true"><div></div></div></div><h3 id="æŠ“åŒ…åˆ°æŒ‡å®šç«¯å£çš„æ•°æ®åŒ…" tabindex="-1"> æŠ“åŒ…åˆ°æŒ‡å®šç«¯å£çš„æ•°æ®åŒ…</h3>
<div><pre><code><span>sudo</span> tcpdump <span>-i</span> eno3 <span>-nn</span> <span>-vvv</span> <span>'host 192.168.2.134 and port 12000'</span>
</code></pre><div aria-hidden="true"><div></div></div></div><blockquote>
<p>è¿™ä¸ªå‘½ä»¤çš„å«ä¹‰æ˜¯ï¼š</p>
<ul>
<li><code>-i &lt;interface&gt;</code>ï¼šæŒ‡å®šç›‘è§†çš„ç½‘ç»œæ¥å£ã€‚</li>
<li><code>-nn</code>ï¼šç¦ç”¨åŸŸåè§£æï¼Œæ˜¾ç¤ºIPåœ°å€è€Œä¸æ˜¯ä¸»æœºåã€‚</li>
<li><code>-vvv</code>ï¼šå¢åŠ è¯¦ç»†çº§åˆ«ï¼Œæ˜¾ç¤ºæ›´å¤šçš„ä¿¡æ¯ã€‚</li>
<li><code>'host &lt;host_ip&gt; and port &lt;port&gt;'</code>ï¼šè¿‡æ»¤å‡ºæŒ‡å®šä¸»æœºå’Œç«¯å£çš„æµé‡</li>
</ul>
</blockquote>
]]></content:encoded>
    </item>
    <item>
      <title>é˜²ç«å¢™</title>
      <link>https://doflam-z.github.io/linux/%E9%98%B2%E7%81%AB%E5%A2%99.html</link>
      <guid>https://doflam-z.github.io/linux/%E9%98%B2%E7%81%AB%E5%A2%99.html</guid>
      <source url="https://doflam-z.github.io/rss.xml">é˜²ç«å¢™</source>
      <pubDate>Mon, 26 Feb 2024 10:08:55 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="é˜²ç«å¢™" tabindex="-1"> é˜²ç«å¢™</h1>
<h3 id="firewalld" tabindex="-1"> Firewalld</h3>
<blockquote>
<p>firewalldé»˜è®¤æ˜¯å…³é—­æ‰€æœ‰ç«¯å£</p>
</blockquote>
<p>å¼€å¯firewalldé˜²ç«å¢™</p>
<div><pre><code>systemctl start firewalld.service       <span>#åœæ­¢firewall</span>
systemctl <span>enable</span> firewalld.service     <span>#ç¦æ­¢firewallå¼€æœºå¯åŠ¨</span>
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>å¼€å¯ç«¯å£</p>
<div><pre><code><span>#ç›´æ¥å¼€æ”¾ç«¯å£</span>
firewall-cmd <span>--zone</span><span>=</span>public --add-port<span>=</span><span>80</span>/tcp <span>--permanent</span>

<span>#å¼€æ”¾æŒ‡å®šipæ®µè®¿é—®æŒ‡å®šç«¯å£</span>
<span>sudo</span> firewall-cmd <span>--permanent</span> --add-rich-rule<span>=</span><span>'rule family=ipv4 source address=192.168.2.0/24 port protocol=tcp port=60011 accept'</span>
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div></div></div><blockquote>
<p>å‘½ä»¤å«ä¹‰ï¼š</p>
<p>--zone #ä½œç”¨åŸŸ</p>
<p>--add-port=80/tcp #æ·»åŠ ç«¯å£ï¼Œæ ¼å¼ä¸ºï¼šç«¯å£/é€šè®¯åè®®</p>
<p>--permanent #æ°¸ä¹…ç”Ÿæ•ˆï¼Œæ²¡æœ‰æ­¤å‚æ•°é‡å¯åå¤±æ•ˆ</p>
</blockquote>
<p>é‡å¯é˜²ç«å¢™</p>
<div><pre><code>firewall-cmd <span>--reload</span> 
</code></pre><div aria-hidden="true"><div></div></div></div><p>å¸¸ç”¨å‘½ä»¤ä»‹ç»</p>
<div><pre><code>firewall-cmd <span>--state</span>              <span>##æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ï¼Œæ˜¯å¦æ˜¯running</span>

firewall-cmd <span>--reload</span>              <span>##é‡æ–°è½½å…¥é…ç½®ï¼Œæ¯”å¦‚æ·»åŠ è§„åˆ™ä¹‹åï¼Œéœ€è¦æ‰§è¡Œæ­¤å‘½ä»¤</span>

firewall-cmd --get-zones            <span>##åˆ—å‡ºæ”¯æŒçš„zone</span>

firewall-cmd --get-services           <span>##åˆ—å‡ºæ”¯æŒçš„æœåŠ¡ï¼Œåœ¨åˆ—è¡¨ä¸­çš„æœåŠ¡æ˜¯æ”¾è¡Œçš„</span>

firewall-cmd --query-service <span>ftp</span>        <span>##æŸ¥çœ‹ftpæœåŠ¡æ˜¯å¦æ”¯æŒï¼Œè¿”å›yesæˆ–è€…no</span>

firewall-cmd --add-service<span>=</span>ftp         <span>##ä¸´æ—¶å¼€æ”¾ftpæœåŠ¡</span>

firewall-cmd --add-service<span>=</span>ftp <span>--permanent</span>   <span>##æ°¸ä¹…å¼€æ”¾ftpæœåŠ¡</span>

firewall-cmd --remove-service<span>=</span>ftp <span>--permanent</span>  <span>##æ°¸ä¹…ç§»é™¤ftpæœåŠ¡</span>

firewall-cmd --add-port<span>=</span><span>80</span>/tcp <span>--permanent</span>   <span>##æ°¸ä¹…æ·»åŠ 80ç«¯å£ </span>

iptables <span>-L</span> <span>-n</span>                 <span>##æŸ¥çœ‹è§„åˆ™ï¼Œè¿™ä¸ªå‘½ä»¤æ˜¯å’Œiptablesçš„ç›¸åŒçš„</span>

<span>man</span> firewall-cmd                <span>##æŸ¥çœ‹å¸®åŠ©</span>
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="iptables" tabindex="-1"> Iptables</h3>
<blockquote>
<p>CentOS 7.0é»˜è®¤ä½¿ç”¨çš„æ˜¯firewallä½œä¸ºé˜²ç«å¢™ï¼Œä½¿ç”¨iptableså¿…é¡»é‡æ–°è®¾ç½®ä¸€ä¸‹</p>
</blockquote>
<h3 id="å¸¸ç”¨è§„åˆ™" tabindex="-1"> å¸¸ç”¨è§„åˆ™</h3>
<p>å…ˆæ‹’ç»æ‰€æœ‰ï¼Œå†å¼€æ”¾ä¸€ä¸ªç«¯å£ç»™æŒ‡å®šipæˆ–è€…åœ°å€æ®µ</p>
<div><pre><code><span>sudo</span> iptables <span>-P</span> INPUT DROP <span># è¿™ä¸ªè§„åˆ™æ‰§è¡Œåï¼Œç°æœ‰è§„åˆ™ä¸ä¼šå¤±æ•ˆï¼Œä½†å…¶è¡Œä¸ºä¼šå—åˆ°é»˜è®¤ç­–ç•¥çš„å½±å“ã€‚è¿™æ˜¯å› ä¸ºé»˜è®¤ç­–ç•¥æ˜¯æ‰€æœ‰æœªåŒ¹é…åˆ°ç°æœ‰è§„åˆ™çš„æµé‡çš„æœ€ç»ˆå¤„ç†æ–¹å¼ã€‚</span>
<span>sudo</span> iptables <span>-I</span> INPUT <span>-s</span> <span>14.23</span>.97.250/192.168.2.0/24 <span>-p</span> tcp <span>--dport</span> <span>60011</span> <span>-j</span> ACCEPT
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>ä¿å­˜è§„åˆ™ã€æ¢å¤è§„åˆ™</p>
<div><pre><code><span>sudo</span> iptables-save <span>></span> /etc/iptables/rules.v4
<span>sudo</span> iptables-restore <span>&lt;</span> /etc/iptables/rules.v4
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>1ã€ç›´æ¥å…³é—­firewalldé˜²ç«å¢™</p>
<div><pre><code>systemctl stop firewalld.service      <span>#åœæ­¢firewall</span>
systemctl disable firewalld.service   <span>#ç¦æ­¢firewallå¼€æœºå¯åŠ¨</span>
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>2ã€è®¾ç½® iptables service</p>
<p>yum -y install iptables-services</p>
<p>å¦‚æœè¦ä¿®æ”¹é˜²ç«å¢™é…ç½®ï¼Œå¦‚å¢åŠ é˜²ç«å¢™ç«¯å£3306</p>
<p>vi /etc/sysconfig/iptables</p>
<p>å¢åŠ è§„åˆ™</p>
<p>-A INPUT -m state --state NEW -m tcp -p tcp --dport 3306 -j ACCEPT</p>
<p>ä¿å­˜é€€å‡ºå</p>
<p>systemctl restart iptables.service #é‡å¯é˜²ç«å¢™ä½¿é…ç½®ç”Ÿæ•ˆ</p>
<p>systemctl enable iptables.service #è®¾ç½®é˜²ç«å¢™å¼€æœºå¯åŠ¨</p>
<p>æœ€åé‡å¯ç³»ç»Ÿä½¿è®¾ç½®ç”Ÿæ•ˆå³å¯ã€‚</p>
<p><strong>æŸ¥çœ‹</strong> <strong>SELinux<strong><strong>çŠ¶æ€åŠå…³é—­</strong></strong>SELinux</strong></p>
<p>æŸ¥çœ‹SELinuxçŠ¶æ€ï¼š</p>
<p>1ã€/usr/sbin/sestatus -v   ##å¦‚æœSELinux statuså‚æ•°ä¸ºenabledå³ä¸ºå¼€å¯çŠ¶æ€</p>
<p>SELinux status:         enabled</p>
<p>2ã€getenforce         ##ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªå‘½ä»¤æ£€æŸ¥</p>
<p>å…³é—­SELinuxï¼š</p>
<p>1ã€ä¸´æ—¶å…³é—­ï¼ˆä¸ç”¨é‡å¯æœºå™¨ï¼‰ï¼š</p>
<p>setenforce 0         ##è®¾ç½®SELinux æˆä¸ºpermissiveæ¨¡å¼</p>
<p>â€‹               ##setenforce 1 è®¾ç½®SELinux æˆä¸ºenforcingæ¨¡å¼</p>
<p>2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶éœ€è¦é‡å¯æœºå™¨ï¼š</p>
<p>ä¿®æ”¹/etc/selinux/config æ–‡ä»¶</p>
<p>å°†SELINUX=enforcingæ”¹ä¸ºSELINUX=disabled</p>
<p>é‡å¯æœºå™¨å³å¯</p>
<p><strong>iptables****é…ç½®</strong></p>
<p>æŸ¥çœ‹iptablesé…ç½®ï¼šiptables -L -n</p>
<p>æ·»åŠ å¸¸ç”¨ç«¯å£è§„åˆ™ï¼š</p>
<p>#å…è®¸å¯¹å¤–è¯·æ±‚çš„è¿”å›åŒ…</p>
<p>iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</p>
<p>#å…è®¸icmpåŒ…é€šè¿‡</p>
<p>iptables -A INPUT -p icmp --icmp-type any -j ACCEPT</p>
<p>#å…è®¸æ¥è‡ªäºloæ¥å£çš„æ•°æ®åŒ…ï¼Œå¦‚æœæ²¡æœ‰æ­¤è§„åˆ™ï¼Œå°†ä¸èƒ½é€šè¿‡127.0.0.1è®¿é—®æœ¬åœ°æœåŠ¡</p>
<p>iptables -A INPUT -i lo -j ACCEPT</p>
<p>#ç¦æ­¢ä¸€ä¸ªipæ®µ</p>
<p>iptables -I INPUT -s 114.64.244.0/24 -j DROP</p>
<p>#å¸¸ç”¨ç«¯å£</p>
<p>iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 21 -j ACCEPT</p>
<p>iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT</p>
<p>iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 23 -j ACCEPT</p>
<p>iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT</p>
<p>iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT</p>
<p>iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 3306 -j ACCEPT</p>
<p>iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 8080 -j ACCEPT</p>
<p>#è¿‡æ»¤æ‰€æœ‰éä»¥ä¸Šè§„åˆ™çš„è¯·æ±‚</p>
<p>iptables -P INPUT DROP</p>
<p>#å¦‚æœè¦æ·»åŠ å†…ç½‘ipä¿¡ä»»ï¼ˆæ¥å—å…¶æ‰€æœ‰TCPè¯·æ±‚ï¼‰</p>
<p>#æ³¨ï¼š(<strong>.</strong>.<strong>.</strong>)ä¸ºIP,ä¸‹åŒ</p>
<p>iptables -A INPUT -p tcp -s <strong>.</strong>.<strong>.</strong> -j ACCEPT</p>
<p>#è¦å°åœä¸€ä¸ªIPï¼Œä½¿ç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤</p>
<p>iptables -I INPUT -s <strong>.</strong>.<strong>.</strong> -j DROP</p>
<p>#è¦è§£å°ä¸€ä¸ªIPï¼Œä½¿ç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤</p>
<p>iptables -D INPUT -s <strong>.</strong>.<strong>.</strong> -j DROP</p>
<p>ä¿å­˜é‡å¯é˜²ç«å¢™</p>
<p>/etc/init.d/iptables save</p>
<p>service iptables restart</p>
<p>å…¶ä»–å¸¸ç”¨å‘½ä»¤ï¼ˆä¸æ˜¯ä¸€å®šè¦åšï¼‰</p>
<p>#å…è®¸æ‰€æœ‰å…¥æ ˆè§„åˆ™</p>
<p>iptables -P INPUT ACCEPT</p>
<p>#æ¸…ç©ºé»˜è®¤æ‰€æœ‰è§„åˆ™</p>
<p>iptables -F</p>
<p>#æ¸…ç©ºè‡ªå®šä¹‰çš„æ‰€æœ‰è§„åˆ™</p>
<p>iptables -X</p>
<p>#è®¡æ•°å™¨ç½®0</p>
<p>iptables -Z</p>
<p>å…³é—­ç«¯å£</p>
<p>å¸¸ç”¨åˆ é™¤ç«¯å£è§„åˆ™</p>
<p># æŸ¥çœ‹å½“å‰ç«¯å£æ‰€åœ¨è¡Œæ•°</p>
<p>iptables -L -n --line-number</p>
<p># åˆ é™¤æŒ‡å®šåºåˆ—çš„ç«¯å£ï¼ˆä¸‹é¢æ˜¯åˆ é™¤ç¬¬äº”æ¡ç«¯å£ï¼‰</p>
<p>iptables -D INPUT 5</p>
<p># ç¡®è®¤æ˜¯å¦å·²ç»åˆ é™¤ï¼Œå¯ä»¥é‡æ–°æŸ¥çœ‹åˆ—è¡¨</p>
<p>iptables -L -n --line-number</p>
<h2 id="debian" tabindex="-1"> debian</h2>
<blockquote>
<p>debianç®¡ç†iptableséœ€è¦ç”¨åˆ°iptables-persistent ï¼Œæˆ–è€…ufw</p>
<p>é€šè¿‡iptables-persistentç”Ÿæˆçš„è§„åˆ™é»˜è®¤å°†è¢«å­˜å‚¨åœ¨ä»¥ä¸‹æ–‡ä»¶ä¸­</p>
<p>/etc/iptables/rules.v4    /etc/iptables/rules.v6</p>
</blockquote>
<h3 id="å®‰è£…iptables-persistentæ¥ä½¿ç”¨iptableså‘½ä»¤" tabindex="-1"> å®‰è£…iptables-persistentæ¥ä½¿ç”¨iptableså‘½ä»¤</h3>
<div><pre><code><span>sudo</span> <span>apt</span> <span>install</span> iptables-persistent <span>-y</span>
<span># ä¿å­˜é‡è½½</span>
<span>sudo</span> netfilter-persistent save
<span>sudo</span> netfilter-persistent reload
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div></div></div><h3 id="æˆ–è€…å®‰è£…ä½¿ç”¨-ufw-æ¥è®¾ç½®é˜²ç«å¢™" tabindex="-1"> æˆ–è€…å®‰è£…ä½¿ç”¨ UFW æ¥è®¾ç½®é˜²ç«å¢™</h3>
<p>å®‰è£…</p>
<div><pre><code><span>sudo</span> <span>apt</span> update
<span>sudo</span> <span>apt</span> <span>install</span> ufw

<span>#æ£€æŸ¥çŠ¶æ€ï¼Œé»˜è®¤æ˜¯å…³é—­</span>
<span>sudo</span> ufw status verbose
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div></div></div><p>UFWé»˜è®¤ç­–ç•¥æ˜¯å…³é—­æ‰€æœ‰è¿›æ¥çš„è¿æ¥ï¼Œå¼€å¯æ‰€æœ‰å‡ºå»çš„è¿æ¥ï¼Œæ–‡ä»¶è·¯å¾„åœ¨ï¼š</p>
<blockquote>
<p>/etc/default/ufw</p>
</blockquote>
<p>å…è®¸ä¸€ä¸ªç«¯å£</p>
<div><pre><code><span>sudo</span> ufw allow <span>7722</span>/tcp
</code></pre><div aria-hidden="true"><div></div></div></div><p>æ‰“å¼€ä¸€æ®µç«¯å£</p>
<div><pre><code><span>sudo</span> ufw allow <span>7100</span>:7200/tcp
<span>sudo</span> ufw allow <span>7100</span>:7200/udp
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>å…è®¸æŒ‡å®šipè®¿é—®æ‰€æœ‰ç«¯å£</p>
<div><pre><code><span>sudo</span> ufw allow from <span>10.10</span>.10.10
</code></pre><div aria-hidden="true"><div></div></div></div><p>å…è®¸æŒ‡å®šipè®¿é—®æŒ‡å®šç«¯å£</p>
<div><pre><code><span>sudo</span> ufw allow from <span>64.63</span>.62.61 to any port <span>22</span>

<span>sudo</span> ufw allow from <span>120.232</span>.65.223 to any port <span>5574,8080</span>,80,9080,443
<span>sudo</span> ufw allow from <span>157.148</span>.45.20 to any port <span>5574,8080</span>,80,9080,443
<span>sudo</span> ufw allow from <span>183.2</span>.143.163 to any port <span>5574,8080</span>,80,9080,443/tcp
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div></div></div><p>å…è®¸æ•´ä¸ªç½‘æ®µ</p>
<div><pre><code><span>sudo</span> ufw allow from <span>192.168</span>.1.0/24 to any port <span>3306</span>
</code></pre><div aria-hidden="true"><div></div></div></div><p>ç¦æ­¢è¿æ¥</p>
<div><pre><code><span>sudo</span> ufw deny from <span>23.24</span>.25.0/24 to any port <span>80</span>
<span>sudo</span> ufw deny from <span>23.24</span>.25.0/24 to any port <span>443</span>
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>æŸ¥çœ‹è§„åˆ™</p>
<div><pre><code><span>sudo</span> ufw status numbered
</code></pre><div aria-hidden="true"><div></div></div></div><p>åˆ é™¤è§„åˆ™</p>
<div><pre><code><span>sudo</span> ufw delete <span>3</span>
</code></pre><div aria-hidden="true"><div></div></div></div><p>å¯åŠ¨ã€å…³é—­ã€é‡ç½®</p>
<div><pre><code><span>sudo</span> ufw <span>enable</span>
<span>sudo</span> ufw disable
<span>sudo</span> ufw reset
</code></pre><div aria-hidden="true"><div></div><div></div><div></div></div></div><h3 id="æ›´æ¢é»˜è®¤sshç«¯å£" tabindex="-1"> æ›´æ¢é»˜è®¤sshç«¯å£</h3>
<div><pre><code><span>#1.å¼€å¯ä¸€ä¸ªsshç«¯å£</span>

<span>vi</span> /etc/ssh/sshd_config

<span>#æŠŠ#Port 22</span>
<span>#ä¿®æ”¹ä¸º</span>

Port <span>22</span>
Port <span>2222</span>

<span>service</span> sshd restart

<span>#é˜²ç«å¢™å¼€å¯2222ç«¯å£ï¼ˆå¦‚æœå¼€å¯äº†selinuxï¼Œè®°å¾—ä¸€å®šè¦å…³é—­ï¼‰</span>

<span>#å»æµ‹è¯•ä¸€ä¸‹2222ç«¯å£æ˜¯å¦å¼€å¯ï¼Œè¿™ç‚¹å¾ˆé‡è¦</span>

<span>#2.è®¾ç½®æ–¹æ³•ä¸€ï¼šåªå…è®¸192.168.5.231è®¿é—®</span>

<span>#è¿è¡Œå®Œä¸‹é¢è¿™ä¸€è¡Œï¼Œä½ å·²ç»ä¸èƒ½è®¿é—®äº†ï¼Œæ”¹ç”¨2222å»è®¾ç½®ä¸‹é¢ä¸€è¡Œ</span>
iptables <span>-I</span> INPUT <span>-p</span> tcp <span>--dport</span> <span>22</span> <span>-j</span> DROP

<span>#ç”¨2222ç«¯å£å»è¿è¡Œä¸‹é¢ä¸€è¡Œï¼Œè¿è¡Œå®Œï¼Œ22ç«¯å£å°±å¯ä»¥ä½¿ç”¨</span>
iptables <span>-I</span> INPUT <span>-s</span> x.x.x.x <span>-p</span> tcp <span>--dport</span> <span>22</span> <span>-j</span> ACCEPT

<span>#ä¿å­˜</span>
<span>service</span> iptables save

<span>#é‡å¯</span>
<span>service</span> iptables restart
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="iptablesé…ç½®è„šæœ¬" tabindex="-1"> iptablesé…ç½®è„šæœ¬</h3>
<div><pre><code>#!/bin/sh

# å…ˆå¤‡ä»½iptablesè§„åˆ™
mkdir /web/shell/iptables_bak
cp /etc/sysconfig/iptables /web/shell/iptables_bak/iptables

# è®¾ç½®ä¹‹å‰å…³é—­é˜²ç«å¢™æ‰æ˜¯æœ€å®‰å…¨çš„åŠæ³•ï¼Œå¦åˆ™ä¼šå‘ç”Ÿè¿æ¥ä¸ä¸Šçš„é—®é¢˜
service iptables stop

# ç¦æ­¢æ‰€æœ‰ipè®¿é—®22ç«¯å£
iptables -I INPUT -p tcp --dport 22 -j DROP

# å¼€æ”¾æŒ‡å®šipå¯ä»¥è¿æ¥22ç«¯å£
iptables -A INPUT -i 127.0.0.1 -p tcp --dport 22 -j ACCEPT
iptables -I INPUT -s x.x.x.x,192.168.2.0/24 -p tcp --dport 22 -j ACCEPT

# å…è®¸éƒ¨åˆ†å‡ºå»çš„ç½‘ç»œ  			
iptables -A OUTPUT -d 192.168.2.0/24,x.x.x.x,121.201.88.88,114.114.114.114 -j ACCEPT    
   
# å…è®¸è®¿é—®çš„å¤–ç½‘
iptables -A OUTPUT -d open.work.weixin.qq.com,v0.api.upyun.com,v1.api.upyun.com,v2.api.upyun.com,v3.api.upyun.com,graph.qq.com,apis.map.qq.com,api.weixin.qq.com,login.weixin.qq.com,wx.qq.com,api.weibo.com,js4.jobui.com,css4.jobui.com,m.jobui.com,www.jobui.com,apis.jobui.com -j ACCEPT


#å…è®¸icmpåŒ…é€šè¿‡,ä¹Ÿå°±æ˜¯å…è®¸ping
iptables -A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT

#æœ¬æœºå¯¹å¤–è¯·æ±‚ç›¸å½“äºOUTPUT,å¯¹äºè¿”å›æ•°æ®åŒ…å¿…é¡»æ¥æ”¶å•Šï¼Œè¿™ç›¸å½“äºINPUTäº†
iptables -I INPUT -i lo -j ACCEPT
iptables -I INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT

# ç¦ç”¨æ‰€æœ‰å‡ºå»çš„ç½‘ç»œ
iptables -P OUTPUT DROP

# ä¿å­˜iptbalesè§„åˆ™
service iptables save

# é‡æ–°å¯åŠ¨
service iptables restart 


</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="iptablesæ“ä½œ" tabindex="-1"> iptablesæ“ä½œ</h3>
<div><pre><code><span># æŸ¥çœ‹æ‰€æœ‰è§„åˆ™åˆ—è¡¨å¹¶æ‰“å°ç¼–å·</span>
iptables <span>-L</span> <span>-n</span> --line-numbers

<span># åˆ é™¤ä¸€æ¡è§„åˆ™</span>
iptables <span>-D</span> INPUT <span>7</span>
<span># æˆ–</span>
iptables <span>-D</span> OUTPUT <span>7</span>

<span># å…è®¸æ‰€æœ‰å‡ºå£è®¿é—®</span>
<span>sudo</span> iptables <span>-A</span> OUTPUT <span>-j</span> ACCEPT

<span>#å…è®¸æ‰€æœ‰å…¥å£è®¿é—®</span>
<span>sudo</span> iptables <span>-A</span> INPUT <span>-j</span> ACCEPT

</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="æ›´æ¢sshç«¯å£è„šæœ¬" tabindex="-1"> æ›´æ¢sshç«¯å£è„šæœ¬</h3>
<div><pre><code><span>#!/bin/sh</span>

<span># å…ˆå¤‡ä»½iptablesè§„åˆ™</span>
<span>mkdir</span> /web/shell/iptables_bak
<span>cp</span> /etc/sysconfig/iptables /web/shell/iptables_bak/iptables

<span>sed</span> <span>-i</span> <span>"s|#Port 22|Port 22|g"</span> /etc/ssh/sshd_config

<span># è®¾ç½®ä¹‹å‰å…³é—­é˜²ç«å¢™æ‰æ˜¯æœ€å®‰å…¨çš„åŠæ³•ï¼Œå¦åˆ™ä¼šå‘ç”Ÿè¿æ¥ä¸ä¸Šçš„é—®é¢˜</span>
<span>#service iptables stop</span>

<span># ç¦æ­¢æ‰€æœ‰ipè®¿é—®22ç«¯å£</span>
iptables <span>-I</span> INPUT <span>-p</span> tcp <span>--dport</span> <span>22</span> <span>-j</span> DROP

<span># å¼€æ”¾æŒ‡å®šipå¯ä»¥è¿æ¥22ç«¯å£</span>
iptables <span>-A</span> INPUT <span>-i</span> <span>127.0</span>.0.1 <span>-p</span> tcp <span>--dport</span> <span>22</span> <span>-j</span> ACCEPT
iptables <span>-I</span> INPUT <span>-s</span> x.x.x.x,192.168.2.0/24 <span>-p</span> tcp <span>--dport</span> <span>22</span> <span>-j</span> ACCEPT

<span>service</span> iptables save
<span>service</span> sshd restart
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>]]></content:encoded>
    </item>
  </channel>
</rss>