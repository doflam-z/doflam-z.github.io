<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <atom:link href="https://doflam-z.github.io/rss.xml" rel="self" type="application/rss+xml"/>
    <title>CodeNote</title>
    <link>https://doflam-z.github.io/</link>
    <description>笔记网站。</description>
    <language>zh-CN</language>
    <pubDate>Thu, 09 Mar 2023 03:36:49 GMT</pubDate>
    <lastBuildDate>Thu, 09 Mar 2023 03:36:49 GMT</lastBuildDate>
    <generator>vuepress-plugin-feed2</generator>
    <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
    <item>
      <title>Lnmp环境搭建</title>
      <link>https://doflam-z.github.io/linux/Debian10%20%20Lnmp%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html</link>
      <guid>https://doflam-z.github.io/linux/Debian10%20%20Lnmp%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html</guid>
      <source url="https://doflam-z.github.io/rss.xml">Lnmp环境搭建</source>
      <pubDate>Fri, 26 Aug 2022 06:14:34 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="lnmp环境搭建" tabindex="-1"> Lnmp环境搭建</h1>
<h3 id="安装开发环境软件包" tabindex="-1"> 安装开发环境软件包</h3>
<div><pre><code>sudo apt-get install -y build-essential libexpat1-dev libgeoip-dev libpng-dev libpcre3-dev libssl-dev libxml2-dev rcs zlib1g-dev libmcrypt-dev libjpeg-dev libpng-dev libwebp-dev pkg-config libbz2-dev libcurl4-openssl-dev autoconf libmemcached-dev libmemcached11

sudo ln -s /usr/include/x86_64-linux-gnu/curl /usr/local/include/curl
</code></pre><div aria-hidden="true"><div></div><div></div><div></div></div></div><h3 id="下载软件源码包" tabindex="-1"> 下载软件源码包</h3>
<div><pre><code>cd /usr/local/src
sudo wget https://cdn.mysql.com/archives/mysql-5.6/mysql-5.6.20.tar.gz
sudo wget https://openresty.org/download/openresty-1.9.7.4.tar.gz
sudo wget https://www.php.net/distributions/php-5.6.20.tar.gz
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div></div></div><h3 id="创建用户nginx、mysql用户" tabindex="-1"> 创建用户nginx、mysql用户</h3>
<div><pre><code>sudo groupadd mysql
sudo useradd -g mysql -d /home/mysql -s /sbin/nologin mysql

sudo groupadd nginx
sudo useradd -g nginx -d /home/nginx -s /sbin/nologin nginx
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="安装nginx" tabindex="-1"> 安装nginx</h3>
<h5 id="下载安装nginx需要的模块" tabindex="-1"> 下载安装nginx需要的模块</h5>
<div><pre><code>cd /usr/local/src
#zlib库
sudo wget http://www.zlib.net/zlib-1.2.11.tar.gz
sudo tar -zxvf zlib-1.2.11.tar.gz
cd zlib-1.2.11
sudo ./configure --prefix=/web/software/zlib
sudo make
sudo make install

#PCRE库
sudo wget https://ftp.pcre.org/pub/pcre/pcre-8.21.tar.gz
sudo tar -zxvf pcre-8.21.tar.gz
cd pcre-8.21
sudo ./config --prefix=/web/software/pcre
sudo make
sudo make install

#openSSL库
#编译安装openssl报错：POD document had syntax errors at /usr/bin/pod2man line 69. make: *** [install_docs]
#解决方法：
rm -f /usr/bin/pod2man 

sudo wget https://www.openssl.org/source/old/1.0.1/openssl-1.0.1.tar.gz
sudo tar -zxvf openssl-1.0.1.tar.gz
cd openssl-1.0.1
sudo ./config shared --prefix=/usr/local/ssl
sudo make
sudo make install

sudo mv -f /usr/bin/openssl /usr/bin/openssl.old
sudo mv -f /usr/include/openssl /usr/include/openssl.old
sudo ln -s /usr/local/ssl/bin/openssl /usr/bin/openssl
sudo ln -s /usr/local/ssl/include/openssl /usr/include/openssl
sudo ln -s /usr/local/ssl/include/openssl /usr/local/include/openssl

#openSSL库
rm -f /usr/bin/pod2man 
sudo wget https://www.openssl.org/source/old/1.0.1/openssl-1.0.1.tar.gz
sudo tar -zxvf openssl-1.0.1.tar.gz
cd openssl-1.0.1
sudo ./config shared --prefix=/web/software/openssl
sudo make
sudo make install

#libunwind库
sudo wget http://download.savannah.gnu.org/releases/libunwind/libunwind-1.1.tar.gz
sudo tar -zxvf libunwind-1.1.tar.gz
cd libunwind-1.1
sudo CFLAGS=-fPIC ./configure
sudo make CFLAGS=-fPIC
sudo make CFLAGS=-fPIC install

#google-perftools
sudo wget https://github.com/gperftools/gperftools/releases/download/gperftools-2.7/gperftools-2.7.tar.gz
sudo tar -zxvf gperftools-2.7.tar.gz
cd gperftools-2.7
sudo ./configure  --enable-frame-pointers
sudo make
sudo make install
#使google-perftools生效:
sudo echo "/usr/local/lib" >> /etc/ld.so.conf.d/usr_local_lib.conf
sudo ldconfig

#ngx_cache_purge-2.3
sudo wget http://labs.frickle.com/files/ngx_cache_purge-2.3.tar.gz
sudo tar -zxvf ngx_cache_purge-2.3.tar.gz

#nginx编译参数（线上）
--prefix=/web/software/openresty/nginx \
--with-cc-opt=-O2 \
--add-module=../ngx_devel_kit-0.3.0 \
--add-module=../iconv-nginx-module-0.14 \
--add-module=../echo-nginx-module-0.59 \
--add-module=../xss-nginx-module-0.05 \
--add-module=../ngx_coolkit-0.2rc3 \
--add-module=../set-misc-nginx-module-0.30 \
--add-module=../form-input-nginx-module-0.12 \
--add-module=../encrypted-session-nginx-module-0.05 \
--add-module=../ngx_postgres-1.0rc7 \
--add-module=../srcache-nginx-module-0.31 \
--add-module=../ngx_lua-0.10.5 \
--add-module=../ngx_lua_upstream-0.05 \
--add-module=../headers-more-nginx-module-0.30 \
--add-module=../array-var-nginx-module-0.05 \
--add-module=../memc-nginx-module-0.17 \
--add-module=../redis-nginx-module-0.3.7 \
--add-module=../rds-json-nginx-module-0.14 \
--add-module=../rds-csv-nginx-module-0.07 \
--with-ld-opt=-Wl,-rpath,/web/software/openresty/luajit/lib \
--user=www \
--group=www \
--with-google_perftools_module \
--with-pcre=/root/baicai-V6/web/nginx/pcre-8.36 \
--with-pcre-jit \
--with-zlib=/root/baicai-V6/web/nginx/zlib-1.2.8 \
--add-module=/root/baicai-V6/web/nginx/openresty-1.9.15.1/../ngx_cache_purge-2.3 \
--with-http_stub_status_module \
--with-http_ssl_module
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="安装openresty-1-9-7-1-包含nginx-1-9-7和插件" tabindex="-1"> 安装openresty-1.9.7.1，包含nginx-1.9.7和插件</h3>
<p>预编译</p>
<div><pre><code>cd /usr/local/src/openresty-1.9.7.4
sudo ./configure \
--prefix=/web/software/openresty \
--user=www \
--group=www \
--with-google_perftools_module \
--with-pcre=../pcre-8.21 \
--with-pcre-jit \
--with-zlib=../zlib-1.2.11 \
--with-openssl=../openssl-1.0.1 \
--add-module=../ngx_cache_purge-2.3 \
--with-http_stub_status_module \
--with-http_ssl_module \
--with-stream
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>编译安装</p>
<div><pre><code>sudo make
sudo make install
#为了统一nginx与其他服务的同步，给nginx目录做软连接
sudo ln -s  /web/software/openresty/nginx  /web/software/nginx
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div></div></div><h3 id="安装php5-6" tabindex="-1"> 安装php5.6</h3>
<div><pre><code><span>#安装m</span>
<span>#zlib</span>
<span>sudo</span> ./configure
<span>sudo</span> <span>make</span>
<span>sudo</span> <span>make</span> <span>install</span>
<span>export</span> <span>LDFLAGS</span><span>=</span><span>"-L/usr/local/zlib/lib"</span>
<span>export</span> <span>CPPFLAGS</span><span>=</span><span>"-I/usr/local/zlib/include"</span>

<span>#jpeg6</span>
<span>#先创建目录，否则会报错</span>
<span>cd</span> /usr/local/src/php/jpeg-6b
<span>sudo</span> <span>mkdir</span> /web/software/jpeg6/
<span>sudo</span> <span>mkdir</span> <span>{</span>/web/software/jpeg6/bin,/web/software/jpeg6/lib,/web/software/jpeg6/include<span>}</span>
<span>sudo</span> <span>mkdir</span> <span>-p</span>  /web/software/jpeg6/man/man1
<span>sudo</span> ./configure <span>--prefix</span><span>=</span>/web/software/jpeg6
<span>sudo</span> <span>make</span>
<span>sudo</span> <span>make</span> <span>install</span>

<span>#libpng2</span>
<span>#安装libpng出现configure: error: ZLib not installed</span>
<span>#1.进入zlib的源文件目录，执行命令 make clean,清除zlib；</span>
<span>#2.重新配置 ./configure,后面不要接--prefix参数；</span>
<span>#然后执行以下命令</span>
<span>export</span> <span>LDFLAGS</span><span>=</span><span>"-L/usr/local/zlib/lib"</span>
<span>export</span> <span>CPPFLAGS</span><span>=</span><span>"-I/usr/local/zlib/include"</span>

<span>sudo</span> ./configure <span>--prefix</span><span>=</span>/web/software/libpng2
<span>sudo</span> <span>make</span>
<span>sudo</span> <span>make</span> <span>install</span>

<span>#freetype2</span>
<span>sudo</span> ./configure <span>--prefix</span><span>=</span>/web/software/freetype2
<span>sudo</span> <span>make</span>
<span>sudo</span> <span>make</span> <span>install</span>

<span>#libxml2</span>
<span>sudo</span> ./configure <span>--prefix</span><span>=</span>/web/software/libxml2
<span>sudo</span> <span>make</span>
<span>sudo</span> <span>make</span> <span>install</span>

<span>#curl</span>
<span>sudo</span> ./configure <span>--prefix</span><span>=</span>/web/software/curl
<span>sudo</span> <span>make</span>
<span>sudo</span> <span>make</span> <span>install</span>


<span>#php编译参数（线上）</span>
<span>sudo</span> ./configure <span>--prefix</span><span>=</span>/web/software/php-5.6.40 <span>\</span>
--with-config-file-path<span>=</span>/web/software/php-5.6.40/lib <span>\</span>
--with-mysql<span>=</span>mysqlnd <span>\</span>
--with-mysqli<span>=</span>mysqlnd <span>\</span>
--with-pdo-mysql<span>=</span>mysqlnd <span>\</span>
--with-jpeg-dir<span>=</span>/web/software/jpeg6 <span>\</span>
--with-png-dir<span>=</span>/web/software/libpng2 <span>\</span>
--with-freetype-dir<span>=</span>/web/software/freetype2 <span>\</span>
--with-libxml-dir<span>=</span>/web/software/libxml2 <span>\</span>
--with-zlib-dir<span>=</span>/usr/local/zlib/ <span>\</span>
--with-curl<span>=</span>/web/software/curl <span>\</span>
--with-openssl<span>=</span>/usr/local/ssl <span>\</span>
--disable-ipv6 <span>\</span>
--enable-sockets <span>\</span>
--disable-debug <span>\</span>
--enable-xml <span>\</span>
--disable-rpath <span>\</span>
--enable-bcmath <span>\</span>
--enable-shmop <span>\</span>
--enable-sysvsem <span>\</span>
--enable-inline-optimization <span>\</span>
--with-curl <span>\</span>
--enable-sysvmsg <span>\</span>
--enable-sysvshm <span>\</span>
--enable-mbregex <span>\</span>
--enable-mbstring <span>\</span>
--with-bz2<span>=</span>/usr <span>\</span>
--enable-gd-native-ttf <span>\</span>
--with-mhash <span>\</span>
--with-xmlrpc <span>\</span>
--enable-zip <span>\</span>
--enable-soap <span>\</span>
--without-pear <span>\</span>
--enable-fpm <span>\</span>
--with-libdir<span>=</span>lib64

<span>#php编译参数（141）</span>
<span>sudo</span> ./configure <span>--prefix</span><span>=</span>/web/software/php-5.6.40 <span>\</span>
--with-config-file-path<span>=</span>/web/software/php-5.6.40/lib <span>\</span>
--with-mysql<span>=</span>mysqlnd <span>\</span>
--with-mysqli<span>=</span>mysqlnd <span>\</span>
--with-pdo-mysql<span>=</span>mysqlnd <span>\</span>
--with-jpeg-dir<span>=</span>/web/software/jpeg6 <span>\</span>
--with-png-dir<span>=</span>/web/software/libpng2 <span>\</span>
--with-freetype-dir<span>=</span>/web/software/freetype2 <span>\</span>
--with-libxml-dir<span>=</span>/web/software/libxml2 <span>\</span>
--with-zlib-dir<span>=</span>/usr/local/zlib/ <span>\</span>
--with-curl<span>=</span>/web/software/curl <span>\</span>
--with-openssl<span>=</span>/usr/local/ssl <span>\</span>
--disable-ipv6 <span>\</span>
--enable-sockets <span>\</span>
--disable-debug <span>\</span>
--enable-xml <span>\</span>
--disable-rpath <span>\</span>
--enable-bcmath <span>\</span>
--enable-shmop <span>\</span>
--enable-sysvsem <span>\</span>
--enable-inline-optimization <span>\</span>
--with-curl <span>\</span>
--enable-sysvmsg <span>\</span>
--enable-sysvshm <span>\</span>
--enable-mbregex <span>\</span>
--enable-mbstring <span>\</span>
--with-bz2<span>=</span>/usr <span>\</span>
--enable-gd-native-ttf <span>\</span>
--with-mhash <span>\</span>
--with-xmlrpc <span>\</span>
--enable-zip <span>\</span>
--enable-soap <span>\</span>
--without-pear <span>\</span>
--enable-fpm <span>\</span>
--enable-pcntl

<span>#编译php时，遇到“Please reinstall the libcurl distribution...”</span>
<span>#sudo apt-get install libcurl4-gnutls-dev</span>
<span>sudo</span> <span>ln</span> <span>-s</span> /usr/include/x86_64-linux-gnu/curl /usr/local/include/curl

<span>#make: *** [Makefile:590：ext/openssl/openssl.lo] 错误 1 (php5.6不兼容openssl1.1.1)</span>
<span>#openssl降级</span>

</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="编译安装php7-4" tabindex="-1"> 编译安装php7.4</h3>
<div><pre><code><span>##/bin/bash</span>

<span>apt-get</span> <span>install</span> <span>-y</span> libsqlite3-dev libmemcached-dev libmagickwand-dev libmagickcore-dev <span>\</span>
libdatrie-dev libmcrypt-dev procps libonig-dev libzip-dev

<span>#apt-get install -y build-essential libexpat1-dev libgeoip-dev libpng-dev libpcre3-dev libssl-dev libxml2-dev rcs zlib1g-dev libmcrypt-dev libjpeg-dev libpng-dev libwebp-dev pkg-config libbz2-dev libcurl4-openssl-dev autoconf libmemcached-dev libmemcached11</span>

<span>cd</span> /usr/local/src/package/php-7.4.24/ <span>&amp;&amp;</span> <span>\</span>
	./configure <span>\</span>
    <span>--prefix</span><span>=</span>/web/software/php-7.4.24 <span>\</span>
    --with-config-file-path<span>=</span>/web/software/php-7.4.24/lib <span>\</span>
    --with-mysqli<span>=</span>mysqlnd <span>\</span>
    --with-pdo-mysql<span>=</span>mysqlnd <span>\</span>
    --with-zlib <span>\</span>
    --disable-ipv6 <span>\</span>
    --enable-sockets <span>\</span>
    --disable-debug <span>\</span>
    --enable-xml <span>\</span>
    --disable-rpath <span>\</span>
    --enable-bcmath <span>\</span>
    --enable-shmop <span>\</span>
    --enable-sysvsem <span>\</span>
    --enable-inline-optimization <span>\</span>
    --enable-sysvmsg <span>\</span>
    --enable-sysvshm <span>\</span>
    --enable-mbregex <span>\</span>
    --enable-mbstring <span>\</span>
    --with-bz2 <span>\</span>
    --with-libxml <span>\</span>
    --with-curl <span>\</span>
    --with-openssl <span>\</span>
    --with-mhash <span>\</span>
    --with-xmlrpc <span>\</span>
    --with-zip <span>\</span>
    --enable-soap <span>\</span>
    --without-pear <span>\</span>
    --enable-fpm <span>&amp;&amp;</span> <span>\</span>
    <span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span>

<span># apcu</span>
    <span>cd</span> /usr/local/src/package/apcu-5.1.19 <span>\</span>
    /web/software/php-7.4.24/bin/phpize <span>\</span>
    ./configure --with-php-config<span>=</span>/web/software/php-7.4.24/bin/php-config <span>\</span>
    <span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span> <span>\</span>
<span># blitz</span>
    <span>cd</span> /usr/local/src/package/blitz-0.10.4-PHP7/ <span>\</span>
    /web/software/php-7.4.24/bin/phpize <span>\</span>
    ./configure --with-php-config<span>=</span>/web/software/php-7.4.24/bin/php-config <span>\</span>
    <span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span> <span>\</span>
<span># memcached</span>
    <span>cd</span> /usr/local/src/package/memcached-3.1.5 <span>\</span>
    /web/software/php-7.4.24/bin/phpize <span>\</span>
    ./configure --with-php-config<span>=</span>/web/software/php-7.4.24/bin/php-config <span>\</span>
    <span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span> <span>\</span>
<span># memcache</span>
    <span>cd</span> /usr/local/src/package/memcache-8.0 <span>\</span>
    /web/software/php-7.4.24/bin/phpize <span>\</span>
    ./configure --with-php-config<span>=</span>/web/software/php-7.4.24/bin/php-config <span>\</span>
    <span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span> <span>\</span>
<span># mongodb</span>
    <span>cd</span> /usr/local/src/package/mongodb-1.10.0 <span>\</span>
    /web/software/php-7.4.24/bin/phpize <span>\</span>
    ./configure --with-php-config<span>=</span>/web/software/php-7.4.24/bin/php-config <span>\</span>
    <span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span> <span>\</span>
<span># igbinary</span>
    <span>cd</span> /usr/local/src/package/igbinary-3.2.6 <span>\</span>
    /web/software/php-7.4.24/bin/phpize <span>\</span>
    ./configure --with-php-config<span>=</span>/web/software/php-7.4.24/bin/php-config <span>\</span>
    <span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span> <span>\</span>
<span># redis</span>
    <span>cd</span> /usr/local/src/package/redis-4.3.0 <span>\</span>
    /web/software/php-7.4.24/bin/phpize <span>\</span>
    ./configure --with-php-config<span>=</span>/web/software/php-7.4.24/bin/php-config <span>\</span>
    <span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span> <span>\</span>
<span># imagick</span>
    <span>cd</span> /usr/local/src/package/imagick-3.5.1 <span>\</span>
    /web/software/php-7.4.24/bin/phpize <span>\</span>
    ./configure --with-php-config<span>=</span>/web/software/php-7.4.24/bin/php-config <span>\</span>
    <span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span> <span>\</span>
<span># qqwry</span>
	<span>cd</span> /usr/local/src/package <span>\</span>
    <span>cd</span> /usr/local/src/package/qqwry-master/php/qqwry/ <span>\</span>
    /web/software/php-7.4.24/bin/phpize <span>\</span>
    ./configure --with-php-config<span>=</span>/web/software/php-7.4.24/bin/php-config <span>\</span>
    <span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span> <span>\</span>
<span># xhprof</span>
    <span>cd</span> /usr/local/src/package/xhprof-2.3.4/extension/ <span>\</span>
    /web/software/php-7.4.24/bin/phpize <span>\</span>
    ./configure --with-php-config<span>=</span>/web/software/php-7.4.24/bin/php-config <span>\</span>
    <span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span> <span>\</span>
<span># php-ext-trie-filter</span>
    <span>cd</span> /usr/local/src/package/php-ext-trie-filter-php7 <span>\</span>
    /web/software/php-7.4.24/bin/phpize <span>\</span>
    ./configure --with-php-config<span>=</span>/web/software/php-7.4.24/bin/php-config <span>\</span>
    <span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span> <span>\</span>
<span># scws</span>
    <span>cd</span> /usr/local/src/package/scws-1.2.3/ <span>\</span>
    ./configure <span>--prefix</span><span>=</span>/web/software/scws-1.2.3/ <span>\</span>
    <span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span> <span>\</span>
    <span>cp</span> <span>-r</span> /usr/local/src/package/dict* /web/software/scws-1.2.3/etc/ <span>\</span>
<span># scws-phpext</span>
    <span>cd</span> /usr/local/src/package/scws-1.2.3/phpext <span>\</span>
    /web/software/php-7.4.24/bin/phpize <span>\</span>
    ./configure --with-scws<span>=</span>/web/software/scws-1.2.3 --with-php-config<span>=</span>/web/software/php-7.4.24/bin/php-config <span>\</span>
    <span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span> <span>\</span>
<span># mcrypt</span>
    <span>cd</span> /usr/local/src/package/mcrypt-1.0.4 <span>\</span>
    /web/software/php-7.4.24/bin/phpize <span>\</span>
    aclocal <span>\</span>
    ./configure --with-php-config<span>=</span>/web/software/php-7.4.24/bin/php-config <span>\</span>
    <span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span> <span>\</span>
<span># gd</span>
    <span>cd</span> /usr/local/src/package/php-7.4.24/ext/gd <span>\</span>
    /web/software/php-7.4.24/bin/phpize <span>\</span>
    ./configure -with-php-config<span>=</span>/web/software/php-7.4.24/bin/php-config --enable-gd --with-jpeg --with-freetype <span>\</span>
    <span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span> <span>\</span>

<span>cp</span> /usr/local/src/docker/php/php-fpm.conf /web/software/php-7.4.24/etc/php-fpm.conf

<span>cp</span> /usr/local/src/docker/php/php-fpm /etc/init.d/php-fpm

<span>chmod</span> <span>755</span> /etc/init.d/php-fpm

</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>shell脚本</title>
      <link>https://doflam-z.github.io/linux/sehll%E8%84%9A%E6%9C%AC.html</link>
      <guid>https://doflam-z.github.io/linux/sehll%E8%84%9A%E6%9C%AC.html</guid>
      <source url="https://doflam-z.github.io/rss.xml">shell脚本</source>
      <pubDate>Fri, 26 Aug 2022 06:14:34 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="shell脚本" tabindex="-1"> shell脚本</h1>
<h3 id="监控进程脚本" tabindex="-1"> 监控进程脚本</h3>
<div><pre><code><span>#!/bin/bash</span>
<span>proc_name</span><span>=</span><span>"webLogKeyWordImport"</span>
<span>proc_num</span><span>(</span><span>)</span>
<span>{</span>
        <span>num</span><span>=</span><span><span>`</span><span>ps</span> <span>-ef</span> <span>|</span> <span>grep</span> $proc_name <span>|</span> <span>grep</span> <span>-v</span> <span>grep</span> <span>|</span> <span>wc</span> <span>-l</span><span>`</span></span>
        <span>return</span> <span>$num</span>
<span>}</span>
proc_num
<span>number</span><span>=</span><span>$?</span>
<span>echo</span> <span>$number</span>
<span>if</span> <span>[</span> <span>$number</span> <span>-eq</span> <span>0</span> <span>]</span>
<span>then</span>
<span>.</span> /web/java/JobuiBatch/s_jobTop.sh
<span>fi</span>
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>本地生成自签泛域名证书</title>
      <link>https://doflam-z.github.io/linux/%E7%94%9F%E6%88%90%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6.html</link>
      <guid>https://doflam-z.github.io/linux/%E7%94%9F%E6%88%90%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6.html</guid>
      <source url="https://doflam-z.github.io/rss.xml">本地生成自签泛域名证书</source>
      <pubDate>Fri, 26 Aug 2022 06:14:34 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="本地生成自签泛域名证书" tabindex="-1"> 本地生成自签泛域名证书</h1>
<p>密钥生成工具，生成后复制或者下载</p>
<p>生成配置文件</p>
<div><pre><code><span>cat</span> <span>&lt;&lt;</span> <span>EOF<span> <span>></span> ssl.cnf</span>
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
subjectAltName = @alt_names
[alt_names]
DNS.1 = *.jobui.com
EOF</span>
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>生成证书</p>
<div><pre><code>openssl x509 <span>-signkey</span> star.jobui.com_key.txt <span>-in</span> star.jobui.com_csr.txt <span>-extfile</span> ssl.cnf <span>-req</span> <span>-days</span> <span>730</span> <span>-out</span> *.jobui.com.crt
</code></pre><div aria-hidden="true"><div></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>supervisor</title>
      <link>https://doflam-z.github.io/services/supervisor.html</link>
      <guid>https://doflam-z.github.io/services/supervisor.html</guid>
      <source url="https://doflam-z.github.io/rss.xml">supervisor</source>
      <pubDate>Fri, 26 Aug 2022 06:14:34 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="supervisor" tabindex="-1"> supervisor</h1>
<h3 id="yum安装" tabindex="-1"> yum安装</h3>
<div><pre><code>yum <span>install</span> epel-release
yum <span>install</span> <span>-y</span> supervisor
systemctl <span>enable</span> supervisord <span># 开机自启动</span>
systemctl start supervisord <span># 启动supervisord服务</span>

systemctl status supervisord <span># 查看supervisord服务状态</span>
<span>ps</span> -ef<span>|</span><span>grep</span> supervisord <span># 查看是否存在supervisord进程</span>
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="编译安装-需要python3支持" tabindex="-1"> 编译安装，需要python3支持</h3>
<div><pre><code><span># 下载安装python3.6.8</span>
<span>wget</span> https://www.python.org/ftp/python/3.6.8/Python-3.6.8.tgz

<span>tar</span> <span>-zxvf</span> Python-3.6.8.tgz

./configure <span>--prefix</span><span>=</span>/usr/local/python3

<span>make</span> <span>&amp;&amp;</span> <span>make</span> <span>install</span>

<span>ln</span> <span>-s</span> /usr/local/python3/bin/python3.6 /usr/bin/python3.6
<span>ln</span> <span>-s</span> /usr/local/python3/bin/pip3 /usr/bin/pip3

<span># 安装依赖</span>
yum <span>install</span> gcc zlib-devel bzip2-devel openssl openssl-devel ncurses-devel sqlite-devel <span>-y</span>

<span>#源码安装supervisor</span>

<span>cd</span> /usr/local/src
<span>wget</span> <span>-c</span> https://files.pythonhosted.org/packages/11/35/eab03782aaf70d87303b21a67c345b953d3b59d4e3971a568c51e523f5c0/supervisor-4.2.1.tar.gz

<span>tar</span> <span>-zxvf</span> supervisor-4.2.1.tar.gz
<span>cd</span> supervisor-4.2.1

Python3.6 setup.py <span>install</span>

<span>#创建软连接：</span>

<span>ln</span> <span>-s</span> /usr/local/python3/bin/supervisorctl /usr/bin/supervisorctl
<span>ln</span> <span>-s</span> /usr/local/python3/bin/supervisord /usr/bin/supervisord
<span>ln</span> <span>-s</span> /usr/local/python3/bin/echo_supervisord_conf /usr/bin/echo_supervisord_conf

<span>mkdir</span> /etc/supervisord.d

<span>#创建启动脚本</span>

<span>vi</span> /etc/init.d/supervisord
<span>#写入如下配置</span>

<span>#!/bin/bash</span>
<span>#</span>
<span># supervisord   This scripts turns supervisord on</span>
<span>#</span>
<span># Author:       Mike McGrath &lt;mmcgrath@redhat.com> (based off yumupdatesd)</span>
<span>#               Jason Koppe &lt;jkoppe@indeed.com> adjusted to read sysconfig,</span>
<span>#                   use supervisord tools to start/stop, conditionally wait</span>
<span>#                   for child processes to shutdown, and startup later</span>
<span>#               Mikhail Mingalev &lt;mingalevme@gmail.com> Merged</span>
<span>#                   redhat-init-jkoppe and redhat-sysconfig-jkoppe, and</span>
<span>#                   made the script "simple customizable".</span>
<span>#               Brendan Maguire &lt;maguire.brendan@gmail.com> Added OPTIONS to</span>
<span>#                   SUPERVISORCTL status call</span>
<span>#</span>
<span># chkconfig:    345 83 04</span>
<span>#</span>
<span># description:  supervisor is a process control utility.  It has a web based</span>
<span>#               xmlrpc interface as well as a few other nifty features.</span>
<span>#               Script was originally written by Jason Koppe &lt;jkoppe@indeed.com>.</span>
<span>#</span>

<span># source function library</span>
<span>.</span> /etc/rc.d/init.d/functions

<span>set</span> <span>-a</span>

<span>PREFIX</span><span>=</span>/usr

<span>SUPERVISORD</span><span>=</span><span>$PREFIX</span>/bin/supervisord
<span>SUPERVISORCTL</span><span>=</span><span>$PREFIX</span>/bin/supervisorctl

<span>PIDFILE</span><span>=</span>/var/run/supervisord.pid
<span>LOCKFILE</span><span>=</span>/var/lock/subsys/supervisord

<span>OPTIONS</span><span>=</span><span>"-c /etc/supervisord.conf"</span>

<span># unset this variable if you don't care to wait for child processes to shutdown before removing the $LOCKFILE-lock</span>
<span>WAIT_FOR_SUBPROCESSES</span><span>=</span>yes

<span># remove this if you manage number of open files in some other fashion</span>
<span>ulimit</span> <span>-n</span> <span>96000</span>

<span>RETVAL</span><span>=</span><span>0</span>


<span>running_pid</span><span>(</span><span>)</span>
<span>{</span>
    <span># Check if a given process pid's cmdline matches a given name</span>
    <span>pid</span><span>=</span><span>$1</span>
    <span>name</span><span>=</span><span>$2</span>
    <span>[</span> <span>-z</span> <span>"<span>$pid</span>"</span> <span>]</span> <span>&amp;&amp;</span> <span>return</span> <span>1</span>
    <span>[</span> <span>!</span> <span>-d</span> /proc/<span>$pid</span> <span>]</span> <span>&amp;&amp;</span> <span>return</span> <span>1</span>
    <span>(</span>cat /proc/<span>$pid</span>/cmdline <span>|</span> <span>tr</span> <span>"<span title="\000">\000</span>"</span> <span>"<span title="\n">\n</span>"</span><span>|</span><span>grep</span> <span>-q</span> <span>$name</span><span>)</span> <span>||</span> <span>return</span> <span>1</span>
    <span>return</span> <span>0</span>
<span>}</span>

<span>running</span><span>(</span><span>)</span>
<span>{</span>
<span># Check if the process is running looking at /proc</span>
<span># (works for all users)</span>

    <span># No pidfile, probably no daemon present</span>
    <span>[</span> <span>!</span> <span>-f</span> <span>"<span>$PIDFILE</span>"</span> <span>]</span> <span>&amp;&amp;</span> <span>return</span> <span>1</span>
    <span># Obtain the pid and check it against the binary name</span>
    <span>pid</span><span>=</span><span><span>`</span><span>cat</span> $PIDFILE<span>`</span></span>
    running_pid <span>$pid</span> <span>$SUPERVISORD</span> <span>||</span> <span>return</span> <span>1</span>
    <span>return</span> <span>0</span>
<span>}</span>

<span>start</span><span>(</span><span>)</span> <span>{</span>
        <span>echo</span> <span>"Starting supervisord: "</span>
	
        <span>if</span> <span>[</span> <span>-e</span> <span>$PIDFILE</span> <span>]</span><span>;</span> <span>then</span> 
		<span>echo</span> <span>"ALREADY STARTED"</span>
		<span>return</span> <span>1</span>
	<span>fi</span>

	<span># start supervisord with options from sysconfig (stuff like -c)</span>
        <span>$SUPERVISORD</span> <span>$OPTIONS</span>
	
	<span># show initial startup status</span>
	<span>$SUPERVISORCTL</span> <span>$OPTIONS</span> status
	
	<span># only create the subsyslock if we created the PIDFILE</span>
        <span>[</span> <span>-e</span> <span>$PIDFILE</span> <span>]</span> <span>&amp;&amp;</span> <span>touch</span> <span>$LOCKFILE</span>
<span>}</span>

<span>stop</span><span>(</span><span>)</span> <span>{</span>
        <span>echo</span> <span>-n</span> <span>"Stopping supervisord: "</span>
        <span>$SUPERVISORCTL</span> <span>$OPTIONS</span> <span>shutdown</span>
	<span>if</span> <span>[</span> <span>-n</span> <span>"<span>$WAIT_FOR_SUBPROCESSES</span>"</span> <span>]</span><span>;</span> <span>then</span> 
            <span>echo</span> <span>"Waiting roughly 60 seconds for <span>$PIDFILE</span> to be removed after child processes exit"</span>
            <span>for</span> <span>sleep</span> <span>in</span>  <span>2</span> <span>2</span> <span>2</span> <span>2</span> <span>4</span> <span>4</span> <span>4</span> <span>4</span> <span>8</span> <span>8</span> <span>8</span> <span>8</span> last<span>;</span> <span>do</span>
                <span>if</span> <span>[</span> <span>!</span> <span>-e</span> <span>$PIDFILE</span> <span>]</span> <span>;</span> <span>then</span>
                    <span>echo</span> <span>"Supervisord exited as expected in under <span>$total_sleep</span> seconds"</span>
                    <span>break</span>
                <span>else</span>
                    <span>if</span> <span>[</span><span>[</span> <span>$sleep</span> <span>-eq</span> <span>"last"</span> <span>]</span><span>]</span> <span>;</span> <span>then</span>
                        <span>echo</span> <span>"Supervisord still working on shutting down. We've waited roughly 60 seconds, we'll let it do its thing from here"</span>
                        <span>return</span> <span>1</span>
                    <span>else</span>
                        <span>sleep</span> <span>$sleep</span>
                        <span>total_sleep</span><span>=</span><span><span>$((</span> $total_sleep <span>+</span> $sleep <span>))</span></span>
                    <span>fi</span>

                <span>fi</span>
            <span>done</span>
        <span>fi</span>

        <span># always remove the subsys. We might have waited a while, but just remove it at this point.</span>
        <span>rm</span> <span>-f</span> <span>$LOCKFILE</span>
<span>}</span>

<span>restart</span><span>(</span><span>)</span> <span>{</span>
        stop
        start
<span>}</span>

<span>case</span> <span>"<span>$1</span>"</span> <span>in</span>
    start<span>)</span>
        start
        <span>RETVAL</span><span>=</span><span>$?</span>
        <span>;</span><span>;</span>
    stop<span>)</span>
        stop
        <span>RETVAL</span><span>=</span><span>$?</span>
        <span>;</span><span>;</span>
    restart<span>|</span>force-reload<span>)</span>
        restart
        <span>RETVAL</span><span>=</span><span>$?</span>
        <span>;</span><span>;</span>
    reload<span>)</span>
        <span>$SUPERVISORCTL</span> <span>$OPTIONS</span> reload
        <span>RETVAL</span><span>=</span><span>$?</span>
        <span>;</span><span>;</span>
    condrestart<span>)</span>
        <span>[</span> <span>-f</span> <span>$LOCKFILE</span> <span>]</span> <span>&amp;&amp;</span> restart
        <span>RETVAL</span><span>=</span><span>$?</span>
        <span>;</span><span>;</span>
    status<span>)</span>
        <span>$SUPERVISORCTL</span> <span>$OPTIONS</span> status
        <span>if</span> running <span>;</span> <span>then</span>
            <span>RETVAL</span><span>=</span><span>0</span>
        <span>else</span>
            <span>RETVAL</span><span>=</span><span>1</span>
        <span>fi</span>
        <span>;</span><span>;</span>
    *<span>)</span>
        <span>echo</span> $<span>"Usage: <span>$0</span> {start|stop|status|restart|reload|force-reload|condrestart}"</span>
        <span>exit</span> <span>1</span>
<span>esac</span>

<span>exit</span> <span>$RETVAL</span>

<span># 加入服务</span>
<span>chkconfig</span> <span>--add</span> supervisord

<span># 设置权限</span>
<span>chmod</span> <span>755</span> /etc/init.d/supervisord

<span># 开机启动</span>
<span>chkconfig</span> supervisord on

<span># 生成配置文件</span>
echo_supervisord_conf <span>></span> /etc/supervisord.conf
<span>vim</span> /etc/supervisord.conf

<span># 修改以下几处</span>

<span>file</span><span>=</span>/var/run/supervisor.sock

<span>logfile</span><span>=</span>/var/log/supervisord.log

<span>pidfile</span><span>=</span>/var/run/supervisord.pid

<span>serverurl</span><span>=</span>unix:///var/run/supervisor.sock

<span>[</span>inet_http_server<span>]</span>         <span>;</span> inet <span>(</span>TCP<span>)</span> server disabled by default
<span>port</span><span>=</span><span>0.0</span>.0.0:9100        <span>;</span> ip_address:port specifier, *:port <span>for</span> all iface
<span>username</span><span>=</span>jobui              <span>;</span> default is no username <span>(</span>open server<span>)</span>
<span>password</span><span>=</span>jobui123              <span>;</span> default is no password <span>(</span>open server<span>)</span>

<span>[</span>include<span>]</span>
files <span>=</span> supervisord.d/*.conf

<span># 新建子文档：</span>
<span>vi</span> /etc/supervisord.d/test.conf

<span>[</span>program:test1<span>]</span>
<span>command</span><span>=</span> php /root/download/test/test1.php
<span>process_name</span><span>=</span>%<span>(</span>program_name<span>)</span>s_%<span>(</span>process_num<span>)</span>02d
<span>autorestart</span><span>=</span>false
<span>autostart</span><span>=</span>false
<span>numprocs</span><span>=</span><span>1</span>
<span>startsecs</span><span>=</span><span>1</span>
<span>stderr_logfile</span><span>=</span>/var/log/test1.err.log
<span>stdout_logfile</span><span>=</span>/var/log/test1.out.log

<span>[</span>program:test2<span>]</span>
<span>command</span><span>=</span> php /root/download/test/test2.php
<span>process_name</span><span>=</span>%<span>(</span>program_name<span>)</span>s_%<span>(</span>process_num<span>)</span>02d
<span>autorestart</span><span>=</span>false
<span>autostart</span><span>=</span>false
<span>numprocs</span><span>=</span><span>1</span>
<span>startsecs</span><span>=</span><span>1</span>
<span>stderr_logfile</span><span>=</span>/var/log/test2.err.log
<span>stdout_logfile</span><span>=</span>/var/log/test2.out.log


<span>[</span>program:test3<span>]</span>
<span>command</span><span>=</span> php /root/download/test/test3.php
<span>process_name</span><span>=</span>%<span>(</span>program_name<span>)</span>s_%<span>(</span>process_num<span>)</span>02d
<span>autorestart</span><span>=</span>false
<span>autostart</span><span>=</span>false
<span>numprocs</span><span>=</span><span>1</span>
<span>startsecs</span><span>=</span><span>1</span>
<span>stderr_logfile</span><span>=</span>/var/log/test3.err.log
<span>stdout_logfile</span><span>=</span>/var/log/test3.out.log

<span># 启动</span>
supervisord <span>-c</span> /etc/supervisord.conf

<span># 查看进程</span>
<span>ps</span> aux <span>|</span> <span>grep</span> supervisord



<span># 查看子进程</span>
supervisorctl status

<span># 控制进程</span>
<span>#supervisord 启动成功后，可以通过 supervisorctl 客户端控制进程，启动、停止、重启。运行 supervisorctl 命令，不加参数，会进入 supervisor 客户端的交互终端，并会列出当前所管理的所有进程。</span>
<span>#输入help可以查看可以执行的命令列表，如果想看某个命令的作用，运行 help 命令名称，如：help stop</span>

stop tomcat <span># 表示停止tomcat进程</span>
stop all <span># 表示停止所有进程</span>
bash终端
supervisorctl status
supervisorctl stop name
supervisorctl start name
supervisorctl restart name
supervisorctl reload
supervisorctl update

<span>#配置参数说明</span>
<span>[</span>unix_http_server<span>]</span>
<span>file</span><span>=</span>/tmp/supervisor.sock   <span>;</span>UNIX socket 文件，supervisorctl 会使用
<span>;</span><span>chmod</span><span>=</span>0700                 <span>;</span>socket文件的mode，默认是0700
<span>;</span><span>chown</span><span>=</span>nobody:nogroup       <span>;</span>socket文件的owner，格式：uid:gid

<span>;</span><span>[</span>inet_http_server<span>]</span>         <span>;</span>HTTP服务器，提供web管理界面
<span>;</span><span>port</span><span>=</span><span>127.0</span>.0.1:9001        <span>;</span>Web管理后台运行的IP和端口，如果开放到公网，需要注意安全性
<span>;</span><span>username</span><span>=</span>user              <span>;</span>登录管理后台的用户名
<span>;</span><span>password</span><span>=</span><span>123</span>               <span>;</span>登录管理后台的密码

<span>[</span>supervisord<span>]</span>
<span>logfile</span><span>=</span>/tmp/supervisord.log <span>;</span>日志文件，默认是 <span>$CWD</span>/supervisord.log
<span>logfile_maxbytes</span><span>=</span>50MB        <span>;</span>日志文件大小，超出会rotate，默认 50MB，如果设成0，表示不限制大小
<span>logfile_backups</span><span>=</span><span>10</span>           <span>;</span>日志文件保留备份数量默认10，设为0表示不备份
<span>loglevel</span><span>=</span>info                <span>;</span>日志级别，默认info，其它: debug,warn,trace
<span>pidfile</span><span>=</span>/tmp/supervisord.pid <span>;</span>pid 文件
<span>nodaemon</span><span>=</span>false               <span>;</span>是否在前台启动，默认是false，即以 daemon 的方式启动
<span>minfds</span><span>=</span><span>1024</span>                  <span>;</span>可以打开的文件描述符的最小值，默认 <span>1024</span>
<span>minprocs</span><span>=</span><span>200</span>                 <span>;</span>可以打开的进程数的最小值，默认 <span>200</span>

<span>[</span>supervisorctl<span>]</span>
<span>serverurl</span><span>=</span>unix:///tmp/supervisor.sock <span>;</span>通过UNIX socket连接supervisord，路径与unix_http_server部分的file一致
<span>;</span><span>serverurl</span><span>=</span>http://127.0.0.1:9001 <span>;</span> 通过HTTP的方式连接supervisord

<span>;</span> <span>[</span>program:xx<span>]</span>是被管理的进程配置参数，xx是进程的名称
<span>[</span>program:xx<span>]</span>
<span>command</span><span>=</span>/opt/apache-tomcat-8.0.35/bin/catalina.sh run  <span>;</span> 程序启动命令
<span>autostart</span><span>=</span>true       <span>;</span> 在supervisord启动的时候也自动启动
<span>startsecs</span><span>=</span><span>10</span>         <span>;</span> 启动10秒后没有异常退出，就表示进程正常启动了，默认为1秒
<span>autorestart</span><span>=</span>true     <span>;</span> 程序退出后自动重启,可选值：<span>[</span>unexpected,true,false<span>]</span>，默认为unexpected，表示进程意外杀死后才重启
<span>startretries</span><span>=</span><span>3</span>       <span>;</span> 启动失败自动重试次数，默认是3
<span>user</span><span>=</span>tomcat          <span>;</span> 用哪个用户启动进程，默认是root
<span>priority</span><span>=</span><span>999</span>         <span>;</span> 进程启动优先级，默认999，值小的优先启动
<span>redirect_stderr</span><span>=</span>true <span>;</span> 把stderr重定向到stdout，默认false
<span>stdout_logfile_maxbytes</span><span>=</span>20MB  <span>;</span> stdout 日志文件大小，默认50MB
stdout_logfile_backups <span>=</span> <span>20</span>   <span>;</span> stdout 日志文件备份数，默认是10
<span>;</span> stdout 日志文件，需要注意当指定目录不存在时无法正常启动，所以需要手动创建目录（supervisord 会自动创建日志文件）
<span>stdout_logfile</span><span>=</span>/opt/apache-tomcat-8.0.35/logs/catalina.out
<span>stopasgroup</span><span>=</span>false     <span>;</span>默认为false,进程被杀死时，是否向这个进程组发送stop信号，包括子进程
<span>killasgroup</span><span>=</span>false     <span>;</span>默认为false，向进程组发送kill信号，包括子进程

<span>;</span>包含其它配置文件
<span>[</span>include<span>]</span>
files <span>=</span> relative/directory/*.ini    <span>;</span>可以指定一个或多个以.ini结束的配置文件
include示例：

<span>[</span>include<span>]</span>
files <span>=</span> /opt/absolute/filename.ini /opt/absolute/*.ini foo.conf config??.ini

</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>子配置文件示例</p>
<div><pre><code><span>[</span>program:queue_MultiTask<span>]</span> <span>;</span>项目名称
directory <span>=</span> /www/wwwroot/www.site.net <span>;</span> 程序的启动目录
<span>command</span> <span>=</span> php think queue:listen <span>--queue</span> MultiTask <span>--tries</span> <span>3</span>  <span>;</span> 启动命令
<span>process_name</span><span>=</span>%<span>(</span>program_name<span>)</span>s_%<span>(</span>process_num<span>)</span>02d
numprocs <span>=</span> <span>3</span>           <span>;</span> 开启的进程数量
autostart <span>=</span> <span>true</span>     <span>;</span> 在 supervisord 启动的时候也自动启动
startsecs <span>=</span> <span>5</span>        <span>;</span> 启动 <span>5</span> 秒后没有异常退出，就当作已经正常启动了
autorestart <span>=</span> <span>true</span>   <span>;</span> 程序异常退出后自动重启
startretries <span>=</span> <span>3</span>     <span>;</span> 启动失败自动重试次数，默认是 <span>3</span>
user <span>=</span> www          <span>;</span> 用哪个用户启动
redirect_stderr <span>=</span> <span>true</span>  <span>;</span> 把 stderr 重定向到 stdout，默认 <span>false</span>
stdout_logfile_maxbytes <span>=</span> 50MB  <span>;</span> stdout 日志文件大小，默认 50MB
stdout_logfile_backups <span>=</span> <span>20</span>     <span>;</span> stdout 日志文件备份数
<span>;</span> stdout 日志文件,需要手动创建目录（supervisord 会自动创建日志文件）
stdout_logfile <span>=</span> /www/wwwroot/www.site.net/queue_MultiTask.log
<span>loglevel</span><span>=</span>info
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>Linux基础命令</title>
      <link>https://doflam-z.github.io/linux/linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4.html</link>
      <guid>https://doflam-z.github.io/linux/linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4.html</guid>
      <source url="https://doflam-z.github.io/rss.xml">Linux基础命令</source>
      <pubDate>Thu, 25 Aug 2022 09:55:40 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="linux基础命令" tabindex="-1"> Linux基础命令</h1>
<h3 id="shell命令" tabindex="-1"> shell命令</h3>
<p>查看一级目录文件夹大小</p>
<div><pre><code><span>sudo</span> <span>du</span> <span>-h</span> --max-depth<span>=</span><span>1</span>
</code></pre><div aria-hidden="true"><div></div></div></div><p>查看已删除文件进程</p>
<div><pre><code><span>lsof</span> <span>|</span> <span>grep</span> deleted 
</code></pre><div aria-hidden="true"><div></div></div></div><p>查看发行版</p>
<div><pre><code>lsb_release <span>-a</span> 
</code></pre><div aria-hidden="true"><div></div></div></div><p>查看cpu核心数</p>
<div><pre><code>nproc
</code></pre><div aria-hidden="true"><div></div></div></div><p>查看cpu型号 “| head -1”是只返回第一个</p>
<div><pre><code><span>cat</span> /proc/cpuinfo <span>|</span><span>grep</span> <span>"model name"</span> <span>|</span> <span>head</span> <span>-1</span>
</code></pre><div aria-hidden="true"><div></div></div></div><p>循环执行一条命令</p>
<div><pre><code><span>while</span> <span>true</span><span>;</span> <span>do</span> <span>date</span><span>;</span> <span>sleep</span> <span>1</span><span>;</span> <span>done</span>
<span>watch</span> <span>-n</span> <span>1</span> <span>-d</span> <span>netstat</span> <span>-ant</span>
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>统计文本中出现关键字的次数</p>
<div><pre><code>grep -o objStr  filename|wc -l
</code></pre><div aria-hidden="true"><div></div></div></div><p>kill掉所有符合关键字的进程</p>
<div><pre><code>ps -ef | grep jobTypeRankDailyData| grep -v grep | cut -c 9-15 | xargs kill

ps -ef | grep rabbitmq| grep -v grep | cut -c 9-15 | xargs kill
</code></pre><div aria-hidden="true"><div></div><div></div><div></div></div></div><p>根据进程id查端口</p>
<div><pre><code><span>netstat</span> <span>-nap</span> <span>|</span> <span>grep</span> 进程pid
</code></pre><div aria-hidden="true"><div></div></div></div><p>根据监听端口查看进程</p>
<div><pre><code><span>netstat</span> <span>-ntpl</span> <span>|</span> <span>grep</span> <span>":8755"</span>
</code></pre><div aria-hidden="true"><div></div></div></div><p>切换用户只执行一条命令的可以用:</p>
<div><pre><code><span>su</span> - user <span>-c</span> <span>command</span>
</code></pre><div aria-hidden="true"><div></div></div></div><p>切换用户执行一个shell文件可以用:</p>
<div><pre><code><span>su</span> - user <span>-s</span> /bin/bash shell.sh
</code></pre><div aria-hidden="true"><div></div></div></div><p>设置环境变量（临时）</p>
<div><pre><code><span>export</span> <span>LIBZIP_LIBS</span><span>=</span><span>"/web/software/libzip-1.3.2/lib"</span>
</code></pre><div aria-hidden="true"><div></div></div></div><p>设置环境变量（永久）(尽量直接编辑，不要echo，容易不小心覆盖文件)</p>
<div><pre><code><span>echo</span> <span>"export ONIG_CFLAGS=/usr/bin/onig-config"</span> <span>>></span> /etc/profile
<span>source</span> /etc/profile
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>rpm查找包</p>
<div><pre><code><span>rpm</span> <span>-q</span> libcurl
</code></pre><div aria-hidden="true"><div></div></div></div><p>rpm安装包</p>
<div><pre><code><span>rpm</span> <span>-ivh</span> libcurl
</code></pre><div aria-hidden="true"><div></div></div></div><p>rpm卸载包 （ --nodeps忽略依赖）</p>
<div><pre><code>rpm -e --nodeps libcurl
</code></pre><div aria-hidden="true"><div></div></div></div><p>搜索替换文件内容</p>
<div><pre><code><span>sudo</span> <span>sed</span> <span>-i</span> <span>'s/track_errors = On/track_errors = Off/g'</span> /web/software/php-7.4.23/lib/php.ini
</code></pre><div aria-hidden="true"><div></div></div></div><p>统计文件夹大小（包含文件）</p>
<div><pre><code><span>du</span> <span>-h</span> --max-depth<span>=</span><span>1</span> /mysql
</code></pre><div aria-hidden="true"><div></div></div></div><p>统计当前目录文件按大小排序</p>
<div><pre><code><span>du</span> <span>-s</span> * <span>|</span> <span>sort</span> <span>-nr</span>
</code></pre><div aria-hidden="true"><div></div></div></div><p>批量解压zip文件到指定文件夹</p>
<div><pre><code><span>ls</span> *.zip <span>|</span> <span>xargs</span> <span>-n1</span> <span>unzip</span> <span>-o</span> <span>-d</span> unzip/
</code></pre><div aria-hidden="true"><div></div></div></div><p>批量解压tar压缩文件</p>
<div><pre><code><span>ls</span> *.tar.gz <span>|</span> <span>xargs</span> <span>-n1</span> <span>tar</span> <span>-zxvf</span>
</code></pre><div aria-hidden="true"><div></div></div></div><p>xargs是给命令传递参数的一个过滤器，可以将前一个命令产生的输出作为后一个命令的参数</p>
<p>命令即将find产生的输出（test2目录下的所有tes文件），作为rm的参数，从而完全删除</p>
<div><pre><code><span>find</span> test2/ <span>-name</span> <span>'*.tes'</span> <span>|</span><span>xargs</span> <span>rm</span> <span>-rf</span>
</code></pre><div aria-hidden="true"><div></div></div></div><h3 id="shell判断" tabindex="-1"> shell判断</h3>
<div><pre><code><span>if</span> list <span>then</span>
	<span>do</span> something here
<span>elif</span> list <span>then</span>
	<span>do</span> another thing here
<span>else</span>
	<span>do</span> something <span>else</span> here
<span>fi</span>
  
<span>#EX1:</span>
<span>#!/bin/sh</span>

<span>SYSTEM</span><span>=</span><span><span>`</span><span>uname</span> <span>-s</span><span>`</span></span>    <span>#获取操作系统类型，我本地是linux</span>

<span>if</span> <span>[</span> <span>$SYSTEM</span> <span>=</span> <span>"Linux"</span> <span>]</span> <span>;</span> <span>then</span>     <span>#如果是linux的话打印linux字符串</span>
<span>echo</span> <span>"Linux"</span>
<span>elif</span> <span>[</span> <span>$SYSTEM</span> <span>=</span> <span>"FreeBSD"</span> <span>]</span> <span>;</span> <span>then</span>   
<span>echo</span> <span>"FreeBSD"</span>
<span>elif</span> <span>[</span> <span>$SYSTEM</span> <span>=</span> <span>"Solaris"</span> <span>]</span> <span>;</span> <span>then</span>
<span>echo</span> <span>"Solaris"</span>
<span>else</span>
<span>echo</span> <span>"What?"</span>
<span>fi</span>     <span>#ifend</span>
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>基本上和其他脚本语言一样。没有太大区别。不过值得注意的是。[]里面的条件判断。[]内两边要有空格</p>
<p>1 字符串判断</p>
<div><pre><code>str1 <span>=</span> str2　　　　　　当两个串有相同内容、长度时为真
str1 <span>!=</span> str2　　　　　 当串str1和str2不等时为真
<span>-n</span> str1　　　　　　　 当串的长度大于0时为真<span>(</span>串非空<span>)</span>
<span>-z</span> str1　　　　　　　 当串的长度为0时为真<span>(</span>空串<span>)</span>
str1　　　　　　　　   当串str1为非空时为真
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div></div></div><p>2 数字的判断</p>
<div><pre><code>int1 <span>-eq</span> int2　　　　两数相等为真
int1 <span>-ne</span> int2　　　　两数不等为真
int1 <span>-gt</span> int2　　　　int1大于int2为真
int1 <span>-ge</span> int2　　　　int1大于等于int2为真
int1 <span>-lt</span> int2　　　　int1小于int2为真
int1 <span>-le</span> int2　　　　int1小于等于int2为真
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>3 文件的判断</p>
<div><pre><code><span>-r</span> <span>file</span>　　　　　用户可读为真
<span>-w</span> <span>file</span>　　　　　用户可写为真
<span>-x</span> <span>file</span>　　　　　用户可执行为真
<span>-f</span> <span>file</span>　　　　　文件为正规文件为真
<span>-d</span> <span>file</span>　　　　　文件为目录为真
<span>-c</span> <span>file</span>　　　　　文件为字符特殊文件为真
<span>-b</span> <span>file</span>　　　　　文件为块特殊文件为真
<span>-s</span> <span>file</span>　　　　　文件大小非0时为真
<span>-t</span> <span>file</span>　　　　　当文件描述符<span>(</span>默认为1<span>)</span>指定的设备为终端时为真
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>3 复杂逻辑判断</p>
<div><pre><code><span>-a</span> 　 　　　　　 与
<span>-o</span>　　　　　　　 或
<span>!</span>　　　　　　　　非
</code></pre><div aria-hidden="true"><div></div><div></div><div></div></div></div><p>4 参数判断</p>
<div><pre><code><span>$0</span> 这个程式的执行名字
<span>$n</span> 这个程式的第n个参数值，n<span>=</span><span>1</span><span>..</span><span>9</span>
<span>$*</span> 这个程式的所有参数,此选项参数可超过9个。
<span>$#</span> 这个程式的参数个数
<span>$$</span> 这个程式的PID<span>(</span>脚本运行的当前进程ID号<span>)</span>
<span>$!</span> 执行上一个背景指令的PID<span>(</span>后台运行的最后一个进程的进程ID号<span>)</span>
<span>$?</span> 执行上一个指令的返回值 <span>(</span>显示最后命令的退出状态。0表示没有错误，其他任何值表明有错误<span>)</span>
$- 显示shell使用的当前选项，与set命令功能相同
<span>$@</span> 跟<span>$*</span>类似，但是可以当作数组
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="判断目录文件数量" tabindex="-1"> 判断目录文件数量</h3>
<p>Linux下有三个命令：<code>ls</code>、<code>grep</code>、<code>wc</code>。通过这三个命令的组合可以统计目录下文件及文件夹的个数。</p>
<p>统计当前目录下文件的个数（不包括目录）</p>
<div><pre><code><span>ls</span> <span>-l</span> <span>|</span> <span>grep</span> <span>"^-"</span> <span>|</span> <span>wc</span> <span>-l</span>
</code></pre><div aria-hidden="true"><div></div></div></div><p>统计当前目录下文件的个数（包括子目录）</p>
<div><pre><code><span>ls</span> -lR<span>|</span> <span>grep</span> <span>"^-"</span> <span>|</span> <span>wc</span> <span>-l</span>
</code></pre><div aria-hidden="true"><div></div></div></div><p>查看某目录下文件夹(目录)的个数（包括子目录）</p>
<div><pre><code><span>ls</span> <span>-lR</span> <span>|</span> <span>grep</span> <span>"^d"</span> <span>|</span> <span>wc</span> <span>-l</span>
</code></pre><div aria-hidden="true"><div></div></div></div><h3 id="vim" tabindex="-1"> vim</h3>
<blockquote>
<p>Vim中如何全选并复制？（区分大小写！！！）</p>
<ol>
<li>全部删除：按esc键后，先按gg（到达顶部），然后dG</li>
<li>全部复制：按esc键后，先按gg，然后ggyG</li>
<li>全选高亮显示：按esc键后，先按gg，然后ggvG或者ggVG</li>
<li>单行复制：按esc键后，然后yy</li>
<li>单行删除：按esc键后，然后dd</li>
<li>粘贴：按esc键后，然后p</li>
</ol>
<p>vim批量注释</p>
<p>1.按下v然后上下键选中内容</p>
<p>2.按下ctrl+v进入列模式，再按下大写I进入插入模式，输入注释符</p>
<p>3.最后按两次esc</p>
<p>vim批量取消注释</p>
<p>1.按ctrl+v，上下键选中后注释符号后按d</p>
</blockquote>
<h3 id="ssh" tabindex="-1"> ssh</h3>
<div><pre><code><span>#生成本机密钥</span>
ssh-keygen <span>-t</span> rsa <span>-C</span> <span>"zax"</span>

<span>#发送公钥到指定服务器账户</span>
<span>scp</span> /home/zax/.ssh/id_rsa.pub zax@192.168.2.132:/home/zax/.ssh/authorized_keys

<span>#使用mkpasswd可以根据自己的定义来随意生成密码，其中包括长度，包含内容的个数等。</span>
<span>#首先需要安装expect</span>
yum <span>-y</span> <span>install</span> <span>expect</span>
<span>#安装完成就可以使用了，以下为使用参数（这几个参数基本够用）：</span>
<span>-l</span> <span>#      (密码的长度定义, 默认是 9)</span>
<span>-d</span> <span>#      (数字个数, 默认是 2)</span>
<span>-c</span> <span>#      (小写字符, 默认是 3)</span>
<span>-C</span> <span>#      (大写字符, 默认是 2)</span>
<span>-s</span> <span>#      (特殊字符, 默认是  1)</span>

mkpasswd <span>-l</span> <span>16</span> <span>-d</span> <span>2</span> <span>-C</span> <span>2</span> <span>-s</span> <span>2</span>

<span>#sshd_config配置只允许指定用户+ip登录</span>
AllowUsers zax@192.168.1.63 zax@192.168.1.75

<span>#iptables配置只允许指定ip登录</span>
<span>#禁止所有ip连接22端口</span>
<span>sudo</span> iptables <span>-I</span> INPUT <span>-p</span> tcp <span>--dport</span> <span>22</span> <span>-j</span> DROP
<span>#开启ip段192.168.1.0/24端的80口 可以改成别的端口号</span>
<span>sudo</span> iptables <span>-I</span> INPUT <span>-s</span> <span>192.168</span>.2.0/24 <span>-p</span> tcp <span>--dport</span> <span>22</span> <span>-j</span> ACCEPT
<span>#保存</span>
sservice iptables save

<span>#删除规则</span>
iptables <span>-L</span> INPUT --line-numbers
iptables <span>-D</span> INPUT <span>7</span>

<span>#安装telnet</span>
yum <span>-y</span> <span>install</span> telnet-server.x86_64

<span>#将disable = yes改为 disable = no，退出保存。</span>
<span>nano</span> /etc/xinetd.d/telnet

<span>#然后启动telnet服务：</span>
<span>service</span> xinetd start

<span>#查看启用的加密算法</span>
<span>sudo</span> <span>ssh</span> <span>-Q</span> cipher

</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="linux-用-grep-查找单个或多个字符串-关键字" tabindex="-1"> linux 用 grep 查找单个或多个字符串（关键字)</h3>
<p>单个字符串进行查找：</p>
<ol>
<li>
<p>查找当前目录文件名中的字符串：    grep  字符串  文件名</p>
</li>
<li>
<p>查找某个文件中字符串，并输出行号：grep -n 字符串 文件名</p>
</li>
<li>
<p>查找当前目录（包含子目录）的字符串：grep -r 字符串 *</p>
</li>
<li>
<p>查找当前目录（包含子目录）的字符串，并输出行号：grep -rn 字符串 *</p>
</li>
<li>
<ul>
<li>:通配符，表示当前目录所有文件，也可以按照某种模式进行匹配，例如：</li>
</ul>
<p>grep 字符串 *.txt   匹配所有文件后缀名为txt的字符串</p>
</li>
<li>
<p>-r ：递归查找</p>
</li>
<li>
<p>-n ：显示行号</p>
</li>
<li>
<p>-R ：查找所有文件包含子目录</p>
</li>
<li>
<p>-i ：忽略大小写</p>
</li>
<li>
<p>2、同时满足多个字符串查找：</p>
</li>
<li>
<p>grep 字符串1 文件名| grep 字符串2|grep 字符串3|grep ...</p>
</li>
<li>
<p>3、满足多个关键字之一</p>
</li>
<li>
<p>grep -E &quot;字符串1|字符串2|字符串3|&quot;  文件名   或者</p>
</li>
<li>
<p>egrep  &quot;字符串1|字符串2|字符串3|&quot;  文件名</p>
</li>
</ol>
<div><pre><code><span>grep</span> <span>-v</span> <span>"^#"</span> /etc/ssh/sshd_config	<span>#不匹配#开头的行</span>
<span>egrep</span> <span>-v</span> <span>"^#|^$"</span> /etc/ssh/sshd_config
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><h3 id="查看实时网速" tabindex="-1"> 查看实时网速</h3>
<div><pre><code><span>watch</span> <span>-n</span> <span>1</span> <span>"/sbin/ifconfig eth1 | grep bytes"</span>
</code></pre><div aria-hidden="true"><div></div></div></div><h3 id="磁盘相关命令" tabindex="-1"> 磁盘相关命令</h3>
<div><pre><code><span>#查看磁盘信息</span>
<span>sudo</span> lsblk

<span>sudo</span> <span>fdisk</span> <span>-l</span>

<span>sudo</span> <span>df</span> <span>-h</span>

<span>#查看分区uuid</span>
<span>sudo</span> blkid

<span>#更新磁盘分区表</span>
partx <span>-v</span> <span>-a</span> /dev/sda

<span>#新建分区</span>
<span>fdisk</span> /dev/sda
n
w

<span>#格式化</span>
<span>sudo</span> mkfs.ext4 /dev/sdb1

<span>#开机读取的挂载目录,可以在这里屏蔽有问题的分区</span>
<span>vim</span> /etc/fstab

<span>#安装smartmontools</span>
------------ 在基于 Debian/Ubuntu 的系统上 ------------
<span>sudo</span> <span>apt-get</span> <span>install</span> smartmontools
------------ 在基于 RHEL/CentOS 的系统上 ------------
<span>sudo</span> yum <span>install</span> smartmontools
<span>#检测</span>
<span>sudo</span> smartctl <span>-H</span> /dev/sda

<span># 测试磁盘读写速度</span>
<span># 测试写入速度</span>
<span>sudo</span> <span>dd</span> <span>if</span><span>=</span>/dev/zero <span>of</span><span>=</span>/jobui/tempfile <span>bs</span><span>=</span>1M <span>count</span><span>=</span><span>1024</span>
<span># 测试读取速度</span>
<span>sudo</span> <span>dd</span> <span>if</span><span>=</span>/jobui/tempfile <span>of</span><span>=</span>/dev/null <span>bs</span><span>=</span>1M <span>count</span><span>=</span><span>1024</span>

<span># 查看硬盘型号</span>
hdparm <span>-i</span> /dev/hda
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="创建lvm磁盘" tabindex="-1"> 创建LVM磁盘</h3>
<div><pre><code><span>#将硬盘添加到pv分区</span>
<span>sudo</span> pvcreate /dev/sda
<span>sudo</span> pvcreate /dev/sdb
<span>sudo</span> pvcreate /dev/sdc
<span>sudo</span> pvcreate /dev/sdd
<span>#查看pv分区信息</span>
<span>sudo</span> pvs

<span>#创建并将sda加入VG_SSD1</span>
<span>sudo</span> vgcreate VG_SSD1 /dev/sda
<span>#将sdb加入VG_SSD1</span>
<span>sudo</span> vgextend VG_SSD1 /dev/sdb

<span>#创建并将sdc加入VG_SSD2</span>
<span>sudo</span> vgcreate VG_SSD2 /dev/sdc
<span>#将sdd加入VG_SSD2</span>
<span>sudo</span> vgextend VG_SSD1 /dev/sdd

<span>#查看vg分区信息</span>
<span>sudo</span> vgs
<span>#查看vg详情</span>
<span>sudo</span> vgdisplay VG_SSD1

<span>#创建lv分区</span>
<span>sudo</span> lvcreate <span>--extents</span> <span>100</span>%FREE VG_SSD1 <span>-n</span> LV_SSD1
<span>sudo</span> lvcreate <span>--extents</span> <span>100</span>%FREE VG_SSD2 <span>-n</span> LV_SSD2
<span>#查看lv分区</span>
<span>sudo</span> lvs
<span>#以上步骤创建完了逻辑卷接下来格式化分区</span>
<span>sudo</span> mkfs.ext4 /dev/VG_SSD1/LV_SSD1
<span>sudo</span> mkfs.ext4 /dev/VG_SSD2/LV_SSD2

<span>#挂载分区</span>
<span>mount</span> <span>-o</span> noatime,nodiratime /dev/mapper/VG_SSD1-LV_SSD1 /ssd_jobui
<span>mount</span> <span>-o</span> noatime,nodiratime /dev/mapper/VG_SSD2-LV_SSD2 /ssd_company


lvm vgscan
lvm vgchange <span>-ay</span>
lvm lvs
最后使用e2fsck命令修复一下LVM磁盘：
e2fsck <span>-f</span> <span>-y</span> /dev/mapper/VolGroup00-LogVol00

</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>tp6笔记</title>
      <link>https://doflam-z.github.io/code/tp6.html</link>
      <guid>https://doflam-z.github.io/code/tp6.html</guid>
      <source url="https://doflam-z.github.io/rss.xml">tp6笔记</source>
      <pubDate>Thu, 25 Aug 2022 09:01:21 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="tp6笔记" tabindex="-1"> tp6笔记</h1>
<h3 id="安装" tabindex="-1"> 安装</h3>
<p>先安装composer</p>
<div><pre><code><span>curl</span> <span>-sS</span> https://getcomposer.org/installer <span>|</span> php
<span>mv</span> composer.phar /usr/local/bin/composer
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>安装项目</p>
<div><pre><code><span>composer</span> create-project topthink/think tp
</code></pre><div aria-hidden="true"><div></div></div></div><p>测试运行</p>
<div><pre><code>php think run
</code></pre><div aria-hidden="true"><div></div></div></div><p>安装扩展</p>
<div><pre><code><span>composer</span> require topthink/think-migration
</code></pre><div aria-hidden="true"><div></div></div></div><p>创建文件</p>
<div><pre><code>php think migrate:create ArticleTable
</code></pre><div aria-hidden="true"><div></div></div></div><p>进入database目录修改代码</p>
<div><pre><code>public <span>function</span> <span>change</span><span>(</span><span>)</span>
<span>{</span>
    // create the table
    <span>$table</span>  <span>=</span>  <span>$this</span>-<span>></span>table<span>(</span><span>'article'</span><span>)</span><span>;</span>
    <span>$table</span>-<span>></span>addColumn<span>(</span><span>'title'</span>, <span>'string'</span>, <span>[</span><span>'comment'</span> <span>=</span><span>></span> <span>'文章标题'</span><span>]</span><span>)</span>
    -<span>></span>addColumn<span>(</span><span>'body'</span>, <span>'text'</span>, <span>[</span><span>'comment'</span> <span>=</span><span>></span> <span>'文章内容'</span><span>]</span><span>)</span>
    -<span>></span>addTimestamps<span>(</span><span>)</span>
    -<span>></span>create<span>(</span><span>)</span><span>;</span>
<span>}</span>
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>运行建表</p>
<div><pre><code>php think migrate:run
</code></pre><div aria-hidden="true"><div></div></div></div><p>生成控制器、模型</p>
<div><pre><code> php think make:controller index@Demo 
 php think make:model Demo
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>安装包</p>
<div><pre><code>composer install --ignore-platform-reqs
</code></pre><div aria-hidden="true"><div></div></div></div><h4 id="多应用" tabindex="-1"> 多应用</h4>
<p>安装多应用扩展，创建应用目录</p>
<div><pre><code><span>composer</span> require topthink/think-multi-app 
php think build adimn
</code></pre><div aria-hidden="true"><div></div><div></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>Debian10常用命令</title>
      <link>https://doflam-z.github.io/linux/debian10.html</link>
      <guid>https://doflam-z.github.io/linux/debian10.html</guid>
      <source url="https://doflam-z.github.io/rss.xml">Debian10常用命令</source>
      <pubDate>Thu, 25 Aug 2022 09:01:21 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="debian10常用命令" tabindex="-1"> Debian10常用命令</h1>
<h3 id="系统相关命令" tabindex="-1"> 系统相关命令</h3>
<p>编辑网卡配置新增配置</p>
<p>vim /etc/network/interfaces</p>
<div><pre><code><span># This file describes the network interfaces available on your system</span>
<span># and how to activate them. For more information, see interfaces(5).</span>

<span>source</span> /etc/network/interfaces.d/*

<span># The loopback network interface</span>

auto lo
iface lo inet loopback

<span># The primary network interface</span>
allow-hotplug eno1
iface eno1 inet static
        address <span>192.168</span>.100.123/24
        gateway <span>192.168</span>.100.1
        <span># dns-* options are implemented by the resolvconf package, if installed</span>
        dns-nameservers <span>127.0</span>.0.1

auto eno1:1
iface eno1:1 inet static
        address <span>192.168</span>.103.125
        netmask <span>255.255</span>.255.0
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>启动新配置命令</p>
<div><pre><code><span>ifup</span> eno1:1
</code></pre><div aria-hidden="true"><div></div></div></div><div><pre><code><span>#重启网络</span>
/etc/init.d/networking restart
<span>#重启网络(防止配置出错断网)</span>
<span>service</span> networking restart <span>&amp;&amp;</span> <span>ifup</span> enp2s0 
<span>sudo</span> <span>ifup</span> enp3s0:0
<span>sudo</span> <span>ifdown</span> enp3s0:0
<span>#重启ssh</span>
/etc/init.d/ssh restart

<span>#安装sudo</span>
<span>apt-get</span> <span>install</span> <span>sudo</span> <span>-y</span>
<span>#将用户添加到sudo组</span>
<span>usermod</span> <span>-aG</span> <span>sudo</span> z

<span>#新建不允许登录用户</span>
<span>useradd</span> <span>-s</span> /sbin/nologin jobui

<span>#新建普通用户并创建home目录指定bash</span>
<span>useradd</span> <span>-m</span> <span>-s</span> /bin/bash jobui

<span>#debian未指定shell问题</span>
<span>#使用usermod命令修改shell类型</span>
<span>usermod</span> <span>-s</span> /bin/bash zax

<span>#vbox虚拟机设置分辨率</span>
cvt <span>1920</span> <span>1080</span>
xrandr <span>--newmode</span> <span>"1920X1080_60.00"</span> <span>173.00</span>  <span>1920</span> <span>2048</span> <span>2248</span> <span>2576</span>  <span>1080</span> <span>1083</span> <span>1088</span> <span>1120</span> <span>-hsync</span> +vsync
xrandr <span>--addmode</span> Virtual1 <span>"1920X1080_60.00"</span>
xrandr <span>--output</span> Virtual1 <span>--mode</span> <span>"1920X1080_60.00"</span>

<span>#将以上内容添加到/etc/profile文件</span>

<span>#添加ll快捷命令</span>
<span>vi</span> ~/.bashrc

<span>#设置ssh开机启动</span>
update-rc.d <span>ssh</span> <span>enable</span>

<span>#禁止开机启动</span>
update-rc.d <span>ssh</span> disabled

<span>#安装im-config</span>
<span>sudo</span> <span>apt</span> <span>install</span> im-config

<span>#运行im-config，选择fcitx输入法</span>
im-config <span>-c</span>

<span>#解决依赖问题</span>
<span>sudo</span> <span>apt</span> <span>install</span> <span>-f</span>

<span>#查找dep包</span>
<span>sudo</span> dpkg <span>-l</span> sog*

<span>#搜索安装包</span>
<span>sudo</span> <span>apt-cache</span> search openlda

<span>#卸载</span>
<span>sudo</span> dpkg <span>-P</span> sogopinyin

<span>#挂载失败问题（ bad option; for several filesystems (e.g. nfs, cifs) you might need a /sbin/mount.&lt;type> helper program.）</span>
<span>sudo</span> <span>apt</span> <span>install</span> nfs-common

<span># vim不能复制</span>

</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>配置apt软件源,更新sources.list</p>
<div><pre><code><span>mv</span> /etc/apt/sources.list /etc/apt/sources.list.bak
<span>cat</span> <span>></span> /etc/apt/sources.list <span>&lt;&lt;</span> <span>EOF
deb http://mirrors.cloud.tencent.com/debian/ buster main non-free contrib
deb http://mirrors.cloud.tencent.com/debian-security buster/updates main
deb http://mirrors.cloud.tencent.com/debian/ buster-updates main non-free contrib
deb http://mirrors.cloud.tencent.com/debian/ buster-backports main non-free contrib

deb-src http://mirrors.cloud.tencent.com/debian-security buster/updates main
deb-src http://mirrors.cloud.tencent.com/debian/ buster main non-free contrib
deb-src http://mirrors.cloud.tencent.com/debian/ buster-updates main non-free contrib
deb-src http://mirrors.cloud.tencent.com/debian/ buster-backports main non-free contrib
EOF</span>

<span>apt-get</span> update <span>-y</span>
<span>apt-get</span> <span>install</span> <span>-y</span> <span>vim</span> <span>wget</span>

<span>source</span> ~/.bashrce
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="修改时区为上海" tabindex="-1"> 修改时区为上海</h3>
<div><pre><code><span>cp</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</code></pre><div aria-hidden="true"><div></div></div></div><h3 id="安装zabbix" tabindex="-1"> 安装zabbix</h3>
<div><pre><code><span>sudo</span> <span>wget</span> https://repo.mysql.com//mysql-apt-config_0.8.17-1_all.deb
<span>sudo</span> dpkg <span>-i</span> mysql-apt-config_0.8.17-1_all.deb
<span>sudo</span> <span>apt</span> update
<span>sudo</span> <span>apt-get</span> <span>install</span> libmysqld-devecho libevent-dev libsnmp-dev libopenipmi-dev

./configure <span>--prefix</span><span>=</span>/web/software/zabbix --enable-server --enable-agent --with-mysql --enable-ipv6 --with-libcurl --with-libxml2 --with-mysql<span>=</span>/usr/bin/mysql_config

<span>sudo</span> ./configure <span>--prefix</span><span>=</span>/web/software/zabbix --enable-server --enable-agent --with-mysql --enable-ipv6 --with-net-snmp --with-libcurl --with-libxml2 --with-openipmi --with-mysql<span>=</span>/usr/bin/mysql_config
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>安装zabbix时,出现报错Unsupported charset or collation for tables: ,应该是msyql创建zabbix数据库是,字符编码出现了问题,参考下列方法修复:
1.删除原有的数据库. drop database zabbix;
2.创建新的zabbix数据库,命令:create database zabbix character set utf8 collate utf8_bin;
3.重新打入zabbix的数据库表内容;
mysql -uroot -p123456 zabbix &lt; schema.sql
mysql -uroot -p123456 zabbix &lt; images.sql
mysql -uroot -p123456 zabbix &lt; data.sql
4.然后重新进入zabbix GUI的web 安装界面就OK了</p>
<div><pre><code><span>sudo</span> <span>chown</span> <span>-R</span> jobui:jobui /web/php/local/zabbix/
<span>sudo</span> <span>chmod</span> <span>-R</span> <span>755</span> /web/php/local/zabbix/
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><h3 id="debian10美化" tabindex="-1"> debian10美化</h3>
<div><pre><code><span>#安装谷歌noto字体</span>
<span>sudo</span> <span>apt</span> <span>install</span> fonts-noto-cjk
<span>#安装依赖</span>
<span>sudo</span> <span>apt</span> <span>install</span> <span>-y</span> gtk2-engines-murrine
<span>#下载Orchis-theme主题</span>
<span>sudo</span> <span>wget</span> https://github.com/vinceliuice/Orchis-theme/archive/refs/heads/master.zip
<span>#下载图标</span>
<span>sudo</span> <span>wget</span>  https://github.com/vinceliuice/Tela-icon-theme/archive/refs/heads/master.zip

</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="安装deepin版微信" tabindex="-1"> 安装deepin版微信</h3>
<div><pre><code><span>#!/bin/bash</span>
<span>mkdir</span> ./deepintemp
<span>cd</span> ./deepintemp
<span>wget</span> http://packages.deepin.com/deepin/pool/non-free/d/deepin-wine/deepin-wine_2.18-22~rc0_all.deb
<span>wget</span> http://packages.deepin.com/deepin/pool/non-free/d/deepin-wine/deepin-wine32_2.18-22~rc0_i386.deb
<span>wget</span> http://packages.deepin.com/deepin/pool/non-free/d/deepin-wine/deepin-wine32-preloader_2.18-22~rc0_i386.deb
<span>wget</span> http://packages.deepin.com/deepin/pool/non-free/d/deepin-wine-helper/deepin-wine-helper_1.2deepin8_i386.deb
<span>wget</span> http://packages.deepin.com/deepin/pool/non-free/d/deepin-wine-plugin/deepin-wine-plugin_1.0deepin2_amd64.deb
<span>wget</span> http://packages.deepin.com/deepin/pool/non-free/d/deepin-wine-plugin-virtual/deepin-wine-plugin-virtual_1.0deepin3_all.deb
<span>wget</span> http://packages.deepin.com/deepin/pool/non-free/d/deepin-wine-uninstaller/deepin-wine-uninstaller_0.1deepin2_i386.deb
<span>wget</span> http://packages.deepin.com/deepin/pool/non-free/u/udis86/udis86_1.72-2_i386.deb
<span>wget</span> http://packages.deepin.com/deepin/pool/non-free/d/deepin-wine/deepin-fonts-wine_2.18-22~rc0_all.deb
<span>wget</span> http://packages.deepin.com/deepin/pool/non-free/d/deepin-wine/deepin-libwine_2.18-22~rc0_i386.deb
<span>wget</span> https://packages.deepin.com/deepin/pool/main/libj/libjpeg-turbo/libjpeg62-turbo_1.5.1-2_amd64.deb --no-check-certificate
<span>wget</span> https://packages.deepin.com/deepin/pool/main/libj/libjpeg-turbo/libjpeg62-turbo_1.5.1-2_i386.deb --no-check-certificate
<span>wget</span> http://packages.deepin.com/deepin/pool/non-free/d/deepin.com.wechat/deepin.com.wechat_2.6.8.65deepin0_i386.deb

<span>echo</span> <span>'准备添加32位支持'</span>
dpkg --add-architecture i386
<span>echo</span> <span>'添加成功，准备刷新apt缓存信息...'</span>
<span>apt</span> update
<span>echo</span> <span>'即将开始安装...'</span>
dpkg <span>-i</span> *.deb
<span>echo</span> <span>'安装完成，正在自动安装依赖...'</span>
<span>apt</span> <span>install</span> <span>-fy</span>
dpkg <span>-i</span> deepin.com.wechat_2.6.8.65deepin0_i386.deb
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>中文问题，进入/opt/deepinwine/tools文件夹</p>
<p>在run.sh 和 run_v2.sh 中修改为</p>
<div><pre><code><span>#WINE_CMD="deepin-wine"改为下行</span>
<span>WINE_CMD</span><span>=</span><span>"LC_ALL=zh_CN.UTF-8 deepin-wine"</span>
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><h3 id="安装navicat" tabindex="-1"> 安装navicat</h3>
<div><pre><code><span>wget</span> https://download3.navicat.com/download/navicat15-premium-en.AppImage --no-check-certificate
<span>chmod</span> +x navicat15-premium-en.AppImage
./navicat15-premium-en.AppImage
</code></pre><div aria-hidden="true"><div></div><div></div><div></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>iptables</title>
      <link>https://doflam-z.github.io/linux/iptables.html</link>
      <guid>https://doflam-z.github.io/linux/iptables.html</guid>
      <source url="https://doflam-z.github.io/rss.xml">iptables</source>
      <pubDate>Thu, 25 Aug 2022 09:01:21 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="iptables" tabindex="-1"> iptables</h1>
<blockquote>
<p>debian管理iptables需要用到iptables-persistent ，或者ufw</p>
<p>通过iptables-persistent生成的规则默认将被存储在以下文件中</p>
<p>/etc/iptables/rules.v4    /etc/iptables/rules.v6</p>
</blockquote>
<h3 id="安装iptables-persistent来使用iptables命令" tabindex="-1"> 安装iptables-persistent来使用iptables命令</h3>
<div><pre><code><span>sudo</span> <span>apt</span> <span>install</span> iptables-persistent <span>-y</span>
<span># 保存重载</span>
<span>sudo</span> netfilter-persistent save
<span>sudo</span> netfilter-persistent reload
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div></div></div><h3 id="或者安装使用-ufw-来设置防火墙" tabindex="-1"> 或者安装使用 UFW 来设置防火墙</h3>
<p>安装</p>
<div><pre><code><span>sudo</span> <span>apt</span> update
<span>sudo</span> <span>apt</span> <span>install</span> ufw

<span>#检查状态，默认是关闭</span>
<span>sudo</span> ufw status verbose
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div></div></div><p>UFW默认策略是关闭所有进来的连接，开启所有出去的连接，文件路径在：</p>
<blockquote>
<p>/etc/default/ufw</p>
</blockquote>
<p>允许一个端口</p>
<div><pre><code><span>sudo</span> ufw allow <span>7722</span>/tcp
</code></pre><div aria-hidden="true"><div></div></div></div><p>打开一段端口</p>
<div><pre><code><span>sudo</span> ufw allow <span>7100</span>:7200/tcp
<span>sudo</span> ufw allow <span>7100</span>:7200/udp
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>允许指定ip访问所有端口</p>
<div><pre><code><span>sudo</span> ufw allow from <span>10.10</span>.10.10
</code></pre><div aria-hidden="true"><div></div></div></div><p>允许指定ip访问指定端口</p>
<div><pre><code><span>sudo</span> ufw allow from <span>64.63</span>.62.61 to any port <span>22</span>

<span>sudo</span> ufw allow from <span>120.232</span>.65.223 to any port <span>5574,8080</span>,80,9080,443
<span>sudo</span> ufw allow from <span>157.148</span>.45.20 to any port <span>5574,8080</span>,80,9080,443
<span>sudo</span> ufw allow from <span>183.2</span>.143.163 to any port <span>5574,8080</span>,80,9080,443/tcp
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div></div></div><p>允许整个网段</p>
<div><pre><code><span>sudo</span> ufw allow from <span>192.168</span>.1.0/24 to any port <span>3306</span>
</code></pre><div aria-hidden="true"><div></div></div></div><p>禁止连接</p>
<div><pre><code><span>sudo</span> ufw deny from <span>23.24</span>.25.0/24 to any port <span>80</span>
<span>sudo</span> ufw deny from <span>23.24</span>.25.0/24 to any port <span>443</span>
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>查看规则</p>
<div><pre><code><span>sudo</span> ufw status numbered
</code></pre><div aria-hidden="true"><div></div></div></div><p>删除规则</p>
<div><pre><code><span>sudo</span> ufw delete <span>3</span>
</code></pre><div aria-hidden="true"><div></div></div></div><p>启动、关闭、重置</p>
<div><pre><code><span>sudo</span> ufw <span>enable</span>
<span>sudo</span> ufw disable
<span>sudo</span> ufw reset
</code></pre><div aria-hidden="true"><div></div><div></div><div></div></div></div><h3 id="更换默认ssh端口" tabindex="-1"> 更换默认ssh端口</h3>
<div><pre><code><span>#1.开启一个ssh端口</span>

<span>vi</span> /etc/ssh/sshd_config

<span>#把#Port 22</span>
<span>#修改为</span>

Port <span>22</span>
Port <span>2222</span>

<span>service</span> sshd restart

<span>#防火墙开启2222端口（如果开启了selinux，记得一定要关闭）</span>

<span>#去测试一下2222端口是否开启，这点很重要</span>

<span>#2.设置方法一：只允许192.168.5.231访问</span>

<span>#运行完下面这一行，你已经不能访问了，改用2222去设置下面一行</span>
iptables <span>-I</span> INPUT <span>-p</span> tcp <span>--dport</span> <span>22</span> <span>-j</span> DROP

<span>#用2222端口去运行下面一行，运行完，22端口就可以使用</span>
iptables <span>-I</span> INPUT <span>-s</span> x.x.x.x <span>-p</span> tcp <span>--dport</span> <span>22</span> <span>-j</span> ACCEPT

<span>#保存</span>
<span>service</span> iptables save

<span>#重启</span>
<span>service</span> iptables restart
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="iptables配置脚本" tabindex="-1"> iptables配置脚本</h3>
<div><pre><code>#!/bin/sh

# 先备份iptables规则
mkdir /web/shell/iptables_bak
cp /etc/sysconfig/iptables /web/shell/iptables_bak/iptables

# 设置之前关闭防火墙才是最安全的办法，否则会发生连接不上的问题
service iptables stop

# 禁止所有ip访问22端口
iptables -I INPUT -p tcp --dport 22 -j DROP

# 开放指定ip可以连接22端口
iptables -A INPUT -i 127.0.0.1 -p tcp --dport 22 -j ACCEPT
iptables -I INPUT -s x.x.x.x,192.168.2.0/24 -p tcp --dport 22 -j ACCEPT

# 允许部分出去的网络  			
iptables -A OUTPUT -d 192.168.2.0/24,x.x.x.x,121.201.88.88,114.114.114.114 -j ACCEPT    
   
# 允许访问的外网
iptables -A OUTPUT -d open.work.weixin.qq.com,v0.api.upyun.com,v1.api.upyun.com,v2.api.upyun.com,v3.api.upyun.com,graph.qq.com,apis.map.qq.com,api.weixin.qq.com,login.weixin.qq.com,wx.qq.com,api.weibo.com,js4.jobui.com,css4.jobui.com,m.jobui.com,www.jobui.com,apis.jobui.com -j ACCEPT


#允许icmp包通过,也就是允许ping
iptables -A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT

#本机对外请求相当于OUTPUT,对于返回数据包必须接收啊，这相当于INPUT了
iptables -I INPUT -i lo -j ACCEPT
iptables -I INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT

# 禁用所有出去的网络
iptables -P OUTPUT DROP

# 保存iptbales规则
service iptables save

# 重新启动
service iptables restart 


</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="iptables操作" tabindex="-1"> iptables操作</h3>
<div><pre><code><span># 查看所有规则列表并打印编号</span>
iptables <span>-L</span> <span>-n</span> --line-numbers

<span># 删除一条规则</span>
iptables <span>-D</span> INPUT <span>7</span>
<span># 或</span>
iptables <span>-D</span> OUTPUT <span>7</span>

<span># 允许所有出口访问</span>
<span>sudo</span> iptables <span>-A</span> OUTPUT <span>-j</span> ACCEPT

<span>#允许所有入口访问</span>
<span>sudo</span> iptables <span>-A</span> INPUT <span>-j</span> ACCEPT

</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id="更换ssh端口脚本" tabindex="-1"> 更换ssh端口脚本</h3>
<div><pre><code><span>#!/bin/sh</span>

<span># 先备份iptables规则</span>
<span>mkdir</span> /web/shell/iptables_bak
<span>cp</span> /etc/sysconfig/iptables /web/shell/iptables_bak/iptables

<span>sed</span> <span>-i</span> <span>"s|#Port 22|Port 22|g"</span> /etc/ssh/sshd_config

<span># 设置之前关闭防火墙才是最安全的办法，否则会发生连接不上的问题</span>
<span>#service iptables stop</span>

<span># 禁止所有ip访问22端口</span>
iptables <span>-I</span> INPUT <span>-p</span> tcp <span>--dport</span> <span>22</span> <span>-j</span> DROP

<span># 开放指定ip可以连接22端口</span>
iptables <span>-A</span> INPUT <span>-i</span> <span>127.0</span>.0.1 <span>-p</span> tcp <span>--dport</span> <span>22</span> <span>-j</span> ACCEPT
iptables <span>-I</span> INPUT <span>-s</span> x.x.x.x,192.168.2.0/24 <span>-p</span> tcp <span>--dport</span> <span>22</span> <span>-j</span> ACCEPT

<span>service</span> iptables save
<span>service</span> sshd restart
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>]]></content:encoded>
    </item>
    <item>
      <title>ElasticSearch</title>
      <link>https://doflam-z.github.io/services/ElasticSearch.html</link>
      <guid>https://doflam-z.github.io/services/ElasticSearch.html</guid>
      <source url="https://doflam-z.github.io/rss.xml">ElasticSearch</source>
      <pubDate>Thu, 25 Aug 2022 09:01:21 GMT</pubDate>
      <content:encoded><![CDATA[<h1 id="elasticsearch" tabindex="-1"> ElasticSearch</h1>
<p>搜索</p>
<div><pre><code>GET _search
{
  "query": {
    "match": {
      "_index" : "jobui_interview_v1"
    }
  },
  "size" : 100
}
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>查看所有索引</p>
<div><pre><code>GET /_cat/indices?v	
GET _cat/indices?v&amp;s=store.size:desc//按大小倒叙
</code></pre><div aria-hidden="true"><div></div><div></div></div></div><p>新建索引映射</p>
<div><pre><code> PUT /jobui_interview_v1/external/1?pretty
{
  "name": "John Doe"
}

GET /jobui_company_album/_mapping?pretty

PUT jobui_interview_v1
{
	"mappings":{
		"interview":{
			"_all": {
				"enabled": false
			},
			"properties":{
				"CIE_ID": {
					"type": "integer"
				},
				"CIE_CompanyID": {
					"type": "integer"
				},
				"CIE_PositionID": {
					"type": "integer"
				},
				"CIE_PositionName": {
					"type": "text",
					"analyzer": "ik_smart",
					"include_in_all": true
				},
				"CIE_CompanyName": {
					"type": "text",
					"analyzer": "ik_smart",
					"include_in_all": true
				},
				"CIE_UserKey": {
					"type": "text",
					"analyzer": "ik_smart",
					"include_in_all": true
				},
				"CIE_UserIP": {
					"type": "text",
					"analyzer": "ik_smart",
					"include_in_all": true
				},
				"CIE_UsefulNum": {
					"type": "integer"
				},
				"CIE_NotUsefulNum": {
					"type": "integer"
				},
				"CIE_IsNick": {
					"type": "text",
					"analyzer": "ik_smart",
					"include_in_all": true
				},
				"CIE_CheckStatus": {
					"type": "text",
					"analyzer": "ik_smart",
					"include_in_all": true
				},
				"CIE_Content": {
					"type": "text",
					"analyzer": "ik_smart",
					"include_in_all": true
				},
				"CIE_ClientType": {
					"type": "text",
					"analyzer": "ik_smart",
					"include_in_all": true
				},
				"CIE_AddTime": {
					"type": "long"
				},
				"CIE_LastCheckTime": {
					"type": "long"
				},
				"CIE_LastUpdateTime": {
					"type": "long"
				},
				"lt": {
					"type": "long"
				}
			}
		}
	},
	"settings": {
		"number_of_shards" :   1,
		"number_of_replicas" : 1
	}
}
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>设置别名</p>
<div><pre><code>PUT /jobui_interview_v1/_alias/jobui_interview
</code></pre><div aria-hidden="true"><div></div></div></div><p>设置别名
PUT /jobui_interview_v1/_alias/jobui_interview</p>
<p>差看映射信息</p>
<div><pre><code>GET /jobui_interview_v1/_mapping?pretty
</code></pre><div aria-hidden="true"><div></div></div></div><p>#查看索引内容</p>
<div><pre><code>GET jobui_interview_v1
</code></pre><div aria-hidden="true"><div></div></div></div><p>删除索引</p>
<div><pre><code>DELETE jobui_interview_v1
</code></pre><div aria-hidden="true"><div></div></div></div><p>查看单个文档</p>
<div><pre><code>GET jobui_company_job_v1/job/9650100?pretty
</code></pre><div aria-hidden="true"><div></div></div></div><p>查询内容</p>
<div><pre><code>POST /jobui_company_job_v1/_search?pretty
{

  "query": { "match": { "SPI_CompanyCity": "上海" } }

}
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>查看集群</p>
<div><pre><code>GET _cluster/health?pretty
</code></pre><div aria-hidden="true"><div></div></div></div><div><pre><code><span>#查看数据（shell）</span>

<span>#查看所有索引（按大小倒序）</span>
<span>curl</span> <span>-XGET</span> <span>'http://192.168.2.135:9200/_cat/indices?v&amp;s=store.size:desc'</span>

<span>#删除索引</span>
<span>curl</span> <span>-XDELETE</span> <span>'http://192.168.2.135:9200/nginx_apis-access-2021.08.31?pretty'</span>

<span>#查看索引mapping</span>
<span>curl</span> <span>"192.168.1.74:9200/索引名称/_mapping"</span>

<span>#查看单个文档</span>
<span>curl</span> <span>-XGET</span> <span>'localhost:9200/索引名称/类型/ID?pretty'</span>

<span>#创建文档</span>
<span>curl</span> <span>-XPUT</span> <span>'localhost:9200/customer/external/1?pretty'</span> <span>-d</span> <span>'
{
  "name": "John Doe"
}'</span>

<span>#查询文档内容</span>
<span>curl</span> <span>-XPOST</span> <span>'localhost:9200/bank/_search?pretty'</span> <span>-d</span> <span>'
{
  "query": { "match": { "address": "mill" } }
}'</span>
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id="es-kibana部署" tabindex="-1"> es+kibana部署</h2>
<p><strong>基础环境：jdk8</strong></p>
<h4 id="安装jdk" tabindex="-1"> 安装jdk</h4>
<p>下载jdk包</p>
<div><pre><code><span>mkdir</span> <span>-p</span> /usr/local/java 
<span>cd</span> /usr/local/java 
<span>wget</span> https://download.oracle.com/otn/java/jdk/8u321-b07/df5ad55fdd604472a86a45a217032c7d/jdk-8u321-linux-x64.tar.gz?AuthParam<span>=</span>1647915953_6b486a8019a80931d2b2bdca8b505d6a
<span>tar</span> zxvf jdk-8u321-linux-x64.tar.gz <span>-C</span> /usr/local/java
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div></div></div><h4 id="配置jdk环境变量" tabindex="-1"> 配置jdk环境变量</h4>
<div><pre><code><span>vim</span> /etc/profile
<span>#添加</span>
<span>JAVA_HOME</span><span>=</span>/usr/local/java/jdk1.8.0_311/
<span>export</span> <span>CLASSPATH</span><span>=</span>$:CLASSPATH:<span>$JAVA_HOME</span>/lib/ 
<span>export</span> <span><span>PATH</span></span><span>=</span><span>$PATH</span><span>:</span><span>$JAVA_HOME</span>/bin 

<span>#加载文件生效</span>
<span>source</span> /etc/profile
<span>#查看版本</span>
<span>java</span> <span>-version</span>
</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id="安装elasticsearch5-6" tabindex="-1"> 安装elasticsearch5.6</h4>
<div><pre><code><span>wget</span> https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.6.16.tar.gz
sha1sum elasticsearch-5.6.16.tar.gz 
<span>tar</span> <span>-xzf</span> elasticsearch-5.6.16.tar.gz

<span>#后台启动并记录pid</span>
<span>cd</span> elasticsearch-5.6.16/ 
./bin/elasticsearch <span>-p</span> /mysql/elasticsearch/elasticsearch-pid <span>-d</span>

<span>#连接测试</span>
<span>curl</span> <span>-XGET</span> <span>192.168</span>.1.36:9200

</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id="安装kibana5-6" tabindex="-1"> 安装kibana5.6</h4>
<div><pre><code><span>wget</span> https://artifacts.elastic.co/downloads/kibana/kibana-5.6.16-linux-x86_64.tar.gz
sha1sum kibana-5.6.16-linux-x86_64.tar.gz 
<span>tar</span> <span>-xzf</span> kibana-5.6.16-linux-x86_64.tar.gz
<span>cd</span> kibana-5.6.16-linux-x86_64/ 

<span>#后台启动</span>
./bin/kibana <span>>></span> /mysql/elasticsearch/kibana.stdout <span><span>2</span>>></span> /mysql/elasticsearch/kibana.stderr <span>&amp;</span>

</code></pre><div aria-hidden="true"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>]]></content:encoded>
    </item>
  </channel>
</rss>